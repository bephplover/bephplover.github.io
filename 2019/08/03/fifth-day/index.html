<!DOCTYPE html>
<html>

<head><meta name="generator" content="Hexo 3.9.0">
  
  <title>fifth-day - Cupid&#39;s Blog</title>
  <meta charset="UTF-8">
  <meta name="description" content="a new ctfer&#39;s study">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link rel="shortcut icon" href="/images/4023.gif" type="image/png">
  <meta name="description" content="16.web4(http://123.206.87.240:8002/web4/)&amp;emsp;&amp;emsp;进入页面后，提示我们查看源代码？那好咱先查看源代码。在script标签中发现如下所示的代码：">
<meta property="og:type" content="article">
<meta property="og:title" content="fifth-day">
<meta property="og:url" content="http://yoursite.com/2019/08/03/fifth-day/index.html">
<meta property="og:site_name" content="Cupid&#39;s Blog">
<meta property="og:description" content="16.web4(http://123.206.87.240:8002/web4/)&amp;emsp;&amp;emsp;进入页面后，提示我们查看源代码？那好咱先查看源代码。在script标签中发现如下所示的代码：">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-08-11T01:19:38.746Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="fifth-day">
<meta name="twitter:description" content="16.web4(http://123.206.87.240:8002/web4/)&amp;emsp;&amp;emsp;进入页面后，提示我们查看源代码？那好咱先查看源代码。在script标签中发现如下所示的代码：">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.15.8/styles/atom-one-dark.css">
  
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
  <link rel="stylesheet" href="/css/style.css?v=1578292068078">
</head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(http://p0.ssl.cdn.btime.com/t01cd55c4b5ab3036c2.jpg#是博客的背景，又是文章默认头图)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">menu</i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="Cupid" class="mdui-btn mdui-btn-icon"><img src="/images/namei.png"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Cupid">
            <img src="/images/namei.png" alt="Cupid">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>61</div>
        <div><span>Tags</span>0</div>
        <div><span>Categories</span>4</div>
    </div>
    <ul class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </ul>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Social</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://space.bilibili.com/23290461" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/bephplover" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Categories</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/CTF/">CTF</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Web漏洞/">Web漏洞</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/密码学/">密码学</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/编程类/">编程类</a>
          <span class="category-list-count">3</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Archive</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2020 Cupid
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    <div class="nexmoe-post-cover"> 
        
            <img src="http://p0.ssl.cdn.btime.com/t01cd55c4b5ab3036c2.jpg#是博客的背景，又是文章默认头图">
        
        <h1>fifth-day</h1>
    </div>
  <div class="nexmoe-post-meta">
    <a><i class="nexmoefont icon-calendar-fill"></i>2019年08月03日</a>
    <a><i class="nexmoefont icon-areachart"></i>2k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 8 分钟</a>
    
    
  </div>
  <article>
    <p>16.web4(<a href="http://123.206.87.240:8002/web4/" title="web4" target="_blank" rel="noopener">http://123.206.87.240:8002/web4/</a>)<br>&emsp;&emsp;进入页面后，提示我们查看源代码？那好咱先查看源代码。<br>在script标签中发现如下所示的代码：<a id="more"></a></p>
<script>
var p1 = '%66%75%6e%63%74%69%6f%6e%20%63%68%65%63%6b%53%75%62%6d%69%74%28%29%7b%76%61%72%20%61%3d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%70%61%73%73%77%6f%72%64%22%29%3b%69%66%28%22%75%6e%64%65%66%69%6e%65%64%22%21%3d%74%79%70%65%6f%66%20%61%29%7b%69%66%28%22%36%37%64%37%30%39%62%32%62';
var p2 = '%61%61%36%34%38%63%66%36%65%38%37%61%37%31%31%34%66%31%22%3d%3d%61%2e%76%61%6c%75%65%29%72%65%74%75%72%6e%21%30%3b%61%6c%65%72%74%28%22%45%72%72%6f%72%22%29%3b%61%2e%66%6f%63%75%73%28%29%3b%72%65%74%75%72%6e%21%31%7d%7d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%6c%65%76%65%6c%51%75%65%73%74%22%29%2e%6f%6e%73%75%62%6d%69%74%3d%63%68%65%63%6b%53%75%62%6d%69%74%3b';
eval(unescape(p1) + unescape('%35%34%61%61%32' + p2));
</script>
<p>&emsp;&emsp;首先这个%应该是一种编码方式，先看一下这个unescape的用法。这个是一种加解密的方式，那先把p1和p2解密一下。<br>function checkSubmit(){<br>var a=document.getElementById(“password”);<br>if(“undefined”!=typeof a){<br>if(“67d709b2baa648cf6e87a7114f1”==a.value)<br>return!0;<br>alert(“Error”);<br>a.focus();<br>return!1}<br>}<br>&emsp;&emsp;document.getElementByI(“levelQuest”).onsubmit=checkSubmit;<br>可以看到p1和p2解码后得到了一个检查提交函数，这道题是一个代码审计类题目。先读一下其内容，变量a=对象document的一个getid方法的password的值。然后是如果undefined不等于a的值并且a的值为67d709b2baa648cf6e87a7114f1就返回零否则会让a调用focus方法，返回1.这儿这上面应该有个大括号不然又是返回0又是返回1的就很懵逼。先把这一长串的解码试试吧，这个好像解码不出来，去表单直接提交试试。提示是再好好看看，欸等一下啊我好像漏了一小串编码%35%34%61%61%32’ + p2后面这个解码函数前面还有一小串，我加上去解码再连接。67d709b2b54aa2aa648cf6e87a7114f1=a.value，再去表单提交一下，成功拿下flag.<br>&emsp;&emsp;summary:这道题总体对我来说难度不是很大，只有这个Unescape这个不怎么认识，其他都能顺着代码解出来，因而这道题收获在更加熟练的审计代码吧，然后又了解了新的一种加密方式，这儿写完后再去多读哈这个unescape.<br>17.flag在index里(<a href="http://123.206.87.240:8005/post/" title="flag在index里" target="_blank" rel="noopener">http://123.206.87.240:8005/post/</a>)<br>&emsp;&emsp;进入页面有一个小链接click me? no那我就点进去看看。链接上面可以看到打开了show.php,然后显示了一个test5先留在这里回去主页面查看下其他的F12。没有什么重要的信息,那目前唯一有用的是index了。这时候就涉及到一个php:filter，对于这个我一直不是很熟悉乘着这个机会我再去了解一下，至于我为什么知道该用这个呢，诶诶，难道是萌新的知觉。<br>&emsp;&emsp;在CSDN上看到的一串理解:php://filter 是php中独有的一个协议，可以作为一个中间流来处理其他流，可以进行任意文件的读取；根据名字，filter，可以很容易想到这个协议可以用来过滤一些东西；这儿还没有说明它的功能，我的理解是这样的，一些重要的敏感文件肯定是先用编码编码过一次的，并且可能用的是会引起PHP代码冲突的，这种情况下就会使用到php:filter这个协议。<br>&emsp;&emsp;构造?file=php://filter/read=convert.base64-encode/recource=index.php这儿的过滤应该理解为筛选出来，而不是不要的部分过滤掉，刚好过滤出来是我们需要的，跟那个wireshark抓包那个过滤器类似。至于这个写法呢，是我在一个博文上看到的，现在到了理解时间。首先是构造的file=这个就不用说了要查看Index文件之后是写的php的filter协议这样之后都是以/文件路径名分隔，read过滤的是base64编码的，然后recource过滤最重要的index.php,就相当于过滤出来经过base64编码的index文件与之前理解的因为这些文件经过编码因而需要使用到过滤器是一样的。我试试交换顺序写会怎么样，果然没有任何显示了看来这个过滤有层次之分，先是说明其条件最后写入这个recource=文件名。在之前是用的read=convert.base64-encode方式过滤编码。好了对于这个学习先到这里，继续做这道题，输入构造语句后会得到下面这一串：<br>太长就不复制了，，直接拿到BPbase64里去解码得到以下代码：</p>
<html>
    <title>Bugku-ctf</title>

<?php
    error_reporting(0);
    if(!$_GET[file]){echo '<a href="./index.php?file=show.php">click me? no';}
    $file=$_GET['file'];
    if(strstr($file,"../")||stristr($file, "tp")||stristr($file,"input")||stristr($file,"data")){
        echo "Oh no!";
        exit();
    }
    include($file); 
//flag:flag{edulcni_elif_lacol_si_siht}
?>
</html>
&emsp;&emsp;无错误回显不说了，如果get方式没有提交了file的话，就链接到href后面那个地址去，file变量的值也为get提交，
百度了一下：strstr(str1,str2) 函数用于判断字符串str2是否是str1的子串。如果是，则该函数返回str2在str1中首次出现的地址；否则，返回NULL。
接着百度了一下：stristr() 函数搜索字符串在另一字符串中的第一次出现。
注释：该函数是二进制安全的。
注释：该函数是不区分大小写的。如需进行区分大小写的搜索，请使用 strstr() 函数。

<p>&emsp;&emsp;两个函数都是搜索第二个字符串在第一个字符串的首次出现的地址，那我们来看一下题目的代码部分：strstr($file,”../“)||stristr($file, “tp”)||stristr($file,”input”)||stristr($file,”data”)。欸我突然发现flag已经给我了呀，，对哈我做题是为了flag吗，那当然不是我是像给他的逻辑处理搞清楚一点，其实是莫名其妙解出题的- -mengbi 3 连。继续看代码，也就是说如果它出现了其中一种情况，就会输出oh no也就是解题失败，那么看下限制了些什么，首先是../，我寻思着这个是根目录的写法吗，之后是tp,还有input,data,也就是限制了它的input流，data流以及tp。还是百度一下这些东西吧。./表示当前目录,../表示父级目录,这个是相对路径中使用的，代表上一级目录。<br>php://filter的限制<br>要求将传进来的参数进入include()；而源代码中便有include($file);因而这道题其实是一个文件包含漏洞，也就是说使用了文件包含的才能使用php://filter这个，我以为以后的题都能这样了哈哈。。不过这里也对这个更清楚的了解了，但关于这个include文件包含的问题。我得下去好好补补功课了。<br>&emsp;&emsp;summary:这道题的不熟练说明自己的知识储备量还不够足，首先对于PHP协议流的不充分掌握以及对于什么情况可以使用PHP协议流就更不知道了，再者就是对于PHP函数，，老问题，学的不够彻底，每次都还需要查看手册才能记起函数的用法，这样会耽搁一定的时间，不过没关系学习是个积累和循序渐进的过程，以后会越来越顺利的，这也是今天一天的总结了，总计约1个半小时，共计2道CTF题目。</p>

  </article>
  
    
<div class="nexmoe-post-copyright">
<i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
<strong>Author：</strong>Cupid<br>
<strong>Link：</strong><a href="http://yoursite.com/2019/08/03/fifth-day/" title="http://yoursite.com/2019/08/03/fifth-day/" target="_blank" rel="noopener">http://yoursite.com/2019/08/03/fifth-day/</a><br>

  <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

</div>


  
  <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '80b2453b6d5f37ad6225',
        clientSecret: '43e99fa852795c9a7b3eb924b2558c64b84bbdeb',
        id: window.location.pathname,
        repo: 'nexmoe.github.io',
        owner: 'nexmoe',
        admin: 'nexmoe'
    })
    gitalk.render('gitalk')
</script>
</section>
</div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>


 
    <script src="https://cdn.jsdelivr.net/npm/smoothscroll-for-websites@1.4.9/SmoothScroll.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/js/app.js?v=1578292068115"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.1.0/lazysizes.min.js"></script>


    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>



  





</body>

</html>
